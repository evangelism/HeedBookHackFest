// Azure Storage JavaScript Client Library 0.2.1-preview.3
// Copyright (c) Microsoft and contributors.  All rights reserved.

require=function e(t,r,n){function s(o,i){if(!r[o]){if(!t[o]){var l="function"==typeof require&&require;if(!i&&l)return l(o,!0);if(a)return a(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var c=r[o]={exports:{}};t[o][0].call(c.exports,function(e){var r=t[o][1][e];return s(r?r:e)},c,c.exports,e,t,r,n)}return r[o].exports}for(var a="function"==typeof require&&require,o=0;o<n.length;o++)s(n[o]);return s}({2:[function(e,t,r){var n=window.AzureStorage||{};n.generateDevelopmentStorageCredentials=function(e){var t="UseDevelopmentStorage=true;";return e&&(t+="DevelopmentStorageProxyUri="+e),t};var s=e("../lib/services/file/fileservice");n.FileService=s,n.FileUtilities=e("../lib/services/file/fileutilities"),n.createFileService=function(e,t,r){return new s(e,t,r)},n.createFileServiceWithSas=function(e,t){return new s(null,null,e,t)};var a=e("../lib/common/common"),o=a.StorageServiceClient,i=a.SharedKey;n.generateAccountSharedAccessSignature=function(e,t,r){var n=o.getStorageSettings(e,t),s=new i(n._name,n._key);return s.generateAccountSignedQueryString(r)},n.Constants=a.Constants,n.StorageUtilities=a.StorageUtilities,n.AccessCondition=a.AccessCondition,n.SR=a.SR,n.StorageServiceClient=o,n.Logger=a.Logger,n.WebResource=a.WebResource,n.Validate=a.validate,n.date=a.date,n.LinearRetryPolicyFilter=a.LinearRetryPolicyFilter,n.ExponentialRetryPolicyFilter=a.ExponentialRetryPolicyFilter,n.RetryPolicyFilter=a.RetryPolicyFilter,window.AzureStorage=n},{"../lib/common/common":5,"../lib/services/file/fileservice":47,"../lib/services/file/fileutilities":48}],47:[function(e,t,r){(function(r){function n(e,t,r,s,a){var o=R.getStorageSettings(e,t,r,s,a);n.super_.call(this,o._name,o._key,o._fileEndpoint,o._usePathStyleUri,o._sasToken),this.singleFileThresholdInBytes=v.DEFAULT_SINGLE_FILE_GET_THRESHOLD_IN_BYTES,this.parallelOperationThreadCount=S.DEFAULT_PARALLEL_OPERATION_THREAD_COUNT}function s(e,t,r,n){var s=function(e){return e&&!n&&(e=encodeURIComponent(e),e=e.replace(/%2F/g,"/"),e=e.replace(/%5C/g,"/"),e=e.replace(/\+/g,"%20")),e},a=e;return t&&("/"!==t[0]&&(a+="/"),a+=s(t)),r&&("/"!==a[a.length-1]&&(a+="/"),a+=s(r)),d.normalize(a).replace(/\\/g,"/")}var a=e("fs"),o=e("querystring"),i=e("url"),l=e("util"),u=e("underscore"),c=e("extend"),d=e("path"),p=e("./../../common/common"),g=e("./../../common/md5-wrapper"),f=p.util,h=p.SR,m=p.validate,y=p.SpeedSummary,R=p.StorageServiceClient,E=p.WebResource,S=p.Constants,v=S.FileConstants,A=S.HeaderConstants,T=S.HttpConstants,I=S.QueryStringConstants,C=p.BatchOperation,y=p.SpeedSummary,N=p.ChunkAllocator,_=p.ChunkStream,F=p.ChunkStreamWithStream,w=p.FileReadStream,O=e("./internal/filerangestream"),M=e("./models/shareresult"),b=e("./models/directoryresult"),P=e("./models/fileresult"),D=p.AclResult,H=e("../../common/errors/errors"),L=H.ArgumentNullError;l.inherits(n,R),n.prototype.getServiceProperties=function(e,t){return this.getAccountServiceProperties(e,t)},n.prototype.setServiceProperties=function(e,t,r){return this.setAccountServiceProperties(e,t,r)},n.prototype.listSharesSegmented=function(e,t,r){this.listSharesSegmentedWithPrefix(null,e,t,r)},n.prototype.listSharesSegmentedWithPrefix=function(e,t,r,n){var s;f.normalizeArgs(r,n,function(e,t){s=e,n=t}),m.validateArgs("listShares",function(e){e.callback(n)});var a=c(!0,{},s),o=E.get().withQueryOption(I.COMP,"list").withQueryOption(I.MAX_RESULTS,a.maxResults).withQueryOption(I.INCLUDE,a.include);f.objectIsNull(t)||o.withQueryOption(I.MARKER,t.nextMarker),o.withQueryOption(I.PREFIX,e);var i=function(e,t){if(e.listSharesResult=null,!e.error){e.listSharesResult={entries:null,continuationToken:null},e.listSharesResult.entries=[];var r=[];e.response.body.EnumerationResults.Shares&&e.response.body.EnumerationResults.Shares.Share&&(r=e.response.body.EnumerationResults.Shares.Share,u.isArray(r)||(r=[r])),r.forEach(function(t){var r=M.parse(t);e.listSharesResult.entries.push(r)}),e.response.body.EnumerationResults.NextMarker&&(e.listSharesResult.continuationToken={nextMarker:null,targetLocation:null},e.listSharesResult.continuationToken.nextMarker=e.response.body.EnumerationResults.NextMarker,e.listSharesResult.continuationToken.targetLocation=e.targetLocation)}var s=function(e){n(e.error,e.listSharesResult,e.response)};t(e,s)};this.performRequest(o,null,a,i)},n.prototype.doesShareExist=function(e,t,r){this._doesShareExist(e,!1,t,r)},n.prototype.createShare=function(e,t,r){var n;f.normalizeArgs(t,r,function(e,t){n=e,r=t}),m.validateArgs("createShare",function(t){t.string(e,"share"),t.shareNameIsValid(e),t.shareQuotaIsValid(n.quota),t.callback(r)});var s=c(!0,{},n),a=E.put(e).withQueryOption(I.RESTYPE,"share").withHeader(A.SHARE_QUOTA,s.quota);a.addOptionalMetadataHeaders(s.metadata);var o=function(t,n){t.shareResult=null,t.error||(t.shareResult=new M(e),t.shareResult.getPropertiesFromHeaders(t.response.headers),s.metadata&&(t.shareResult.metadata=s.metadata));var a=function(e){r(e.error,e.shareResult,e.response)};n(t,a)};this.performRequest(a,null,s,o)},n.prototype.createShareIfNotExists=function(e,t,r){var n;f.normalizeArgs(t,r,function(e,t){n=e,r=t}),m.validateArgs("createShareIfNotExists",function(t){t.string(e,"share"),t.shareNameIsValid(e),t.callback(r)});var s=c(!0,{},n),a=this;a._doesShareExist(e,!0,s,function(t,n,o){var i=n.exists;n.created=!1,delete n.exists,t?r(t,n,o):i?(o.isSuccessful=!0,r(t,n,o)):a.createShare(e,s,function(e,t,n){e?e&&e.statusCode===T.HttpResponseCodes.Conflict&&e.code===S.FileErrorCodeStrings.SHARE_ALREADY_EXISTS&&(e=null,n.isSuccessful=!0):t.created=!0,r(e,t,n)})})},n.prototype.getShareProperties=function(e,t,r){var n;f.normalizeArgs(t,r,function(e,t){n=e,r=t}),m.validateArgs("getShareProperties",function(t){t.string(e,"share"),t.shareNameIsValid(e),t.callback(r)});var s=c(!0,{},n),a=E.head(e).withQueryOption(I.RESTYPE,"share"),o=this,i=function(t,n){t.shareResult=null,t.error||(t.shareResult=new M(e),t.shareResult.metadata=o.parseMetadataHeaders(t.response.headers),t.shareResult.getPropertiesFromHeaders(t.response.headers));var s=function(e){r(e.error,e.shareResult,e.response)};n(t,s)};this.performRequest(a,null,s,i)},n.prototype.setShareProperties=function(e,t,r,n){var a;f.normalizeArgs(r,n,function(e,t){a=e,n=t}),m.validateArgs("setShareProperties",function(t){t.string(e,"share"),t.shareNameIsValid(e),t.shareQuotaIsValid(a.quota),t.callback(n)});var o=c(!0,t,a),i=s(e),l=E.put(i).withQueryOption(I.RESTYPE,"share").withQueryOption(I.COMP,"properties").withHeader(A.SHARE_QUOTA,o.quota);P.setProperties(l,o);var u=function(t,r){t.shareResult=null,t.error||(t.shareResult=new M(e),t.shareResult.getPropertiesFromHeaders(t.response.headers));var s=function(e){n(e.error,e.shareResult,e.response)};r(t,s)};this.performRequest(l,null,o,u)},n.prototype.getShareStats=function(e,t,r){var n;f.normalizeArgs(t,r,function(e,t){n=e,r=t}),m.validateArgs("getShareStats",function(e){e.callback(r)});var a=c(!0,{},n),o=s(e),i=E.get(o).withQueryOption(I.RESTYPE,"share").withQueryOption(I.COMP,"stats"),l=function(t,n){t.shareResult=null,t.error||(t.shareResult=M.parse(t.response.body,e),t.shareResult.getPropertiesFromHeaders(t.response.headers));var s=function(e){r(e.error,e.shareResult,e.response)};n(t,s)};this.performRequest(i,null,a,l)},n.prototype.getShareMetadata=function(e,t,r){var n;f.normalizeArgs(t,r,function(e,t){n=e,r=t}),m.validateArgs("getShareMetadata",function(t){t.string(e,"share"),t.shareNameIsValid(e),t.callback(r)});var s=c(!0,{},n),a=E.head(e).withQueryOption(I.RESTYPE,"share").withQueryOption(I.COMP,"metadata"),o=this,i=function(t,n){t.shareResult=null,t.error||(t.shareResult=new M(e),t.shareResult.metadata=o.parseMetadataHeaders(t.response.headers),t.shareResult.getPropertiesFromHeaders(t.response.headers));var s=function(e){r(e.error,e.shareResult,e.response)};n(t,s)};this.performRequest(a,null,s,i)},n.prototype.setShareMetadata=function(e,t,r,n){var s;f.normalizeArgs(r,n,function(e,t){s=e,n=t}),m.validateArgs("setShareMetadata",function(r){r.string(e,"share"),r.object(t,"metadata"),r.shareNameIsValid(e),r.callback(n)});var a=c(!0,{},s),o=E.put(e).withQueryOption(I.RESTYPE,"share").withQueryOption(I.COMP,"metadata");o.addOptionalMetadataHeaders(t);var i=function(t,r){t.shareResult=null,t.error||(t.shareResult=new M(e),t.shareResult.getPropertiesFromHeaders(t.response.headers));var s=function(e){n(e.error,e.shareResult,e.response)};r(t,s)};this.performRequest(o,null,a,i)},n.prototype.getShareAcl=function(e,t,r){var n;f.normalizeArgs(t,r,function(e,t){n=e,r=t}),m.validateArgs("getShareAcl",function(t){t.string(e,"share"),t.shareNameIsValid(e),t.callback(r)});var s=c(!0,{},n),a=E.get(e).withQueryOption(I.RESTYPE,"share").withQueryOption(I.COMP,"acl");s.requestLocationMode=S.RequestLocationMode.PRIMARY_OR_SECONDARY;var o=function(t,n){t.shareResult=null,t.error||(t.shareResult=new M(e),t.shareResult.getPropertiesFromHeaders(t.response.headers),t.shareResult.signedIdentifiers=D.parse(t.response.body));var s=function(e){r(e.error,e.shareResult,e.response)};n(t,s)};this.performRequest(a,null,s,o)},n.prototype.setShareAcl=function(e,t,n,s){var a;f.normalizeArgs(n,s,function(e,t){a=e,s=t}),m.validateArgs("setShareAcl",function(t){t.string(e,"share"),t.shareNameIsValid(e),t.callback(s)});var o=c(!0,{},a),i=null;if(t){if(u.isArray(t))throw new TypeError(h.INVALID_SIGNED_IDENTIFIERS);i=D.serialize(t)}var l=E.put(e).withQueryOption(I.RESTYPE,"share").withQueryOption(I.COMP,"acl").withHeader(A.CONTENT_LENGTH,f.objectIsNull(i)?0:r.byteLength(i)).withBody(i),d=function(r,n){r.shareResult=null,r.error||(r.shareResult=new M(e),r.shareResult.getPropertiesFromHeaders(r.response.headers),t&&(r.shareResult.signedIdentifiers=t));var a=function(e){s(e.error,e.shareResult,e.response)};n(r,a)};this.performRequest(l,l.body,o,d)},n.prototype.deleteShare=function(e,t,r){var n;f.normalizeArgs(t,r,function(e,t){n=e,r=t}),m.validateArgs("deleteShare",function(t){t.string(e,"share"),t.shareNameIsValid(e),t.callback(r)});var s=c(!0,{},n),a=E.del(e).withQueryOption(I.RESTYPE,"share"),o=function(e,t){var n=function(e){r(e.error,e.response)};t(e,n)};this.performRequest(a,null,s,o)},n.prototype.deleteShareIfExists=function(e,t,r){var n;f.normalizeArgs(t,r,function(e,t){n=e,r=t}),m.validateArgs("deleteShareIfExists",function(t){t.string(e,"share"),t.shareNameIsValid(e),t.callback(r)});var s=c(!0,{},n),a=this;a._doesShareExist(e,!0,s,function(t,n,o){t?r(t,n.exists,o):n.exists?a.deleteShare(e,s,function(e,t){var n;e?e&&e.statuscode===T.HttpResponseCodes.NotFound&&e.code===S.FileErrorCodeStrings.SHARE_NOT_FOUND&&(n=!1,e=null,t.isSuccessful=!0):n=!0,r(e,n,t)}):(o.isSuccessful=!0,r(t,!1,o))})},n.prototype.doesDirectoryExist=function(e,t,r,n){this._doesDirectoryExist(e,t,!1,r,n)},n.prototype.createDirectory=function(e,t,r,n){var a;f.normalizeArgs(r,n,function(e,t){a=e,n=t}),m.validateArgs("createDirectory",function(r){r.string(e,"share"),r.string(t,"directory"),r.shareNameIsValid(e),r.callback(n)});var o=c(!0,{},a),i=E.put(s(e,t)).withQueryOption(I.RESTYPE,"directory");i.addOptionalMetadataHeaders(o.metadata);var l=function(e,r){e.directoryResult=null,e.error||(e.directoryResult=new b(t),e.directoryResult.getPropertiesFromHeaders(e.response.headers));var s=function(e){n(e.error,e.directoryResult,e.response)};r(e,s)};this.performRequest(i,null,o,l)},n.prototype.createDirectoryIfNotExists=function(e,t,r,n){var s;f.normalizeArgs(r,n,function(e,t){s=e,n=t}),m.validateArgs("createDirectoryIfNotExists",function(r){r.string(e,"share"),r.string(t,"directory"),r.shareNameIsValid(e),r.callback(n)});var a=c(!0,{},s),o=this;o._doesDirectoryExist(e,t,!0,a,function(r,s,i){var l=s.exists;s.created=!1,delete s.exists,r?n(r,s,i):l?(i.isSuccessful=!0,n(r,s,i)):o.createDirectory(e,t,a,function(e,t,r){e?e&&e.statusCode===T.HttpResponseCodes.Conflict&&e.code===S.StorageErrorCodeStrings.RESOURCE_ALREADY_EXISTS&&(e=null,r.isSuccessful=!0):t.created=!0,n(e,t,r)})})},n.prototype.getDirectoryProperties=function(e,t,r,n){var a;f.normalizeArgs(r,n,function(e,t){a=e,n=t}),m.validateArgs("getDirectoryProperties",function(r){r.string(e,"share"),r.stringAllowEmpty(t,"directory"),r.shareNameIsValid(e),r.callback(n)});var o=c(!0,{},a),i=E.head(s(e,t)).withQueryOption(I.RESTYPE,"directory"),l=this,u=function(e,r){e.directoryResult=null,e.error||(e.directoryResult=new b(t),e.directoryResult.metadata=l.parseMetadataHeaders(e.response.headers),e.directoryResult.getPropertiesFromHeaders(e.response.headers));var s=function(e){n(e.error,e.directoryResult,e.response)};r(e,s)};this.performRequest(i,null,o,u)},n.prototype.deleteDirectory=function(e,t,r,n){var a;f.normalizeArgs(r,n,function(e,t){a=e,n=t}),m.validateArgs("deleteDirectory",function(r){r.string(e,"share"),r.string(t,"directory"),r.shareNameIsValid(e),r.callback(n)});var o=c(!0,{},a),i=E.del(s(e,t)).withQueryOption(I.RESTYPE,"directory"),l=function(e,t){var r=function(e){n(e.error,e.response)};t(e,r)};this.performRequest(i,null,o,l)},n.prototype.deleteDirectoryIfExists=function(e,t,r,n){var s;f.normalizeArgs(r,n,function(e,t){s=e,n=t}),m.validateArgs("deleteDirectoryIfExists",function(r){r.string(e,"share"),r.string(t,"directory"),r.shareNameIsValid(e),r.callback(n)});var a=c(!0,{},s),o=this;o._doesDirectoryExist(e,t,!0,a,function(r,s,i){r?n(r,s.exists,i):s.exists?o.deleteDirectory(e,t,a,function(e,t){var r;e?e&&e.statuscode===T.HttpResponseCodes.NotFound&&e.code===S.StorageErrorCodeStrings.RESOURCE_NOT_FOUND&&(r=!1,e=null,t.isSuccessful=!0):r=!0,n(e,r,t)}):(i.isSuccessful=!0,n(r,!1,i))})},n.prototype.listFilesAndDirectoriesSegmented=function(e,t,r,n,s){this.listFilesAndDirectoriesSegmentedWithPrefix(e,t,null,r,n,s)},n.prototype.listFilesAndDirectoriesSegmentedWithPrefix=function(e,t,r,n,a,o){var i;f.normalizeArgs(a,o,function(e,t){i=e,o=t}),m.validateArgs("listFilesSegmented",function(r){r.string(e,"share"),r.stringAllowEmpty(t,"directory"),r.shareNameIsValid(e),r.callback(o)});var l=c(!0,{},i),d=E.get(s(e,t)).withQueryOption(I.RESTYPE,"directory").withQueryOption(I.COMP,"list").withQueryOption(I.MAX_RESULTS,l.maxResults);f.objectIsNull(n)||d.withQueryOption(I.MARKER,n.nextMarker),d.withQueryOption(I.PREFIX,r);var p=function(e,t){if(e.listResult=null,!e.error){e.listResult={entries:null,continuationToken:null},e.listResult.entries={},e.listResult.entries.files=[],e.listResult.entries.directories=[];var r=[],n=[];e.response.body.EnumerationResults.Entries.File&&(r=e.response.body.EnumerationResults.Entries.File,u.isArray(r)||(r=[r])),r.forEach(function(t){var r=P.parse(t);e.listResult.entries.files.push(r)}),e.response.body.EnumerationResults.Entries.Directory&&(n=e.response.body.EnumerationResults.Entries.Directory,u.isArray(n)||(n=[n])),n.forEach(function(t){var r=b.parse(t);e.listResult.entries.directories.push(r)}),e.response.body.EnumerationResults.NextMarker&&(e.listResult.continuationToken={nextMarker:null,targetLocation:null},e.listResult.continuationToken.nextMarker=e.response.body.EnumerationResults.NextMarker,e.listResult.continuationToken.targetLocation=e.targetLocation)}var s=function(e){o(e.error,e.listResult,e.response)};t(e,s)};this.performRequest(d,null,l,p)},n.prototype.getDirectoryMetadata=function(e,t,r,n){var a;f.normalizeArgs(r,n,function(e,t){a=e,n=t}),m.validateArgs("getDirectoryMetadata",function(r){r.string(e,"share"),r.stringAllowEmpty(t,"directory"),r.shareNameIsValid(e),r.callback(n)});var o=c(!0,{},a),i=s(e,t),l=E.head(i).withQueryOption(I.RESTYPE,"directory").withQueryOption(I.COMP,"metadata"),u=this,d=function(e,r){e.directoryResult=null,e.error||(e.directoryResult=new b(t),e.directoryResult.metadata=u.parseMetadataHeaders(e.response.headers),e.directoryResult.getPropertiesFromHeaders(e.response.headers));var s=function(e){n(e.error,e.directoryResult,e.response)};r(e,s)};this.performRequest(l,null,o,d)},n.prototype.setDirectoryMetadata=function(e,t,r,n,a){var o;f.normalizeArgs(n,a,function(e,t){o=e,a=t}),m.validateArgs("setDirectoryMetadata",function(n){n.string(e,"share"),n.stringAllowEmpty(t,"directory"),n.shareNameIsValid(e),n.object(r,"metadata"),n.callback(a)});var i=c(!0,{},o),l=s(e,t),u=E.put(l).withQueryOption(I.RESTYPE,"directory").withQueryOption(I.COMP,"metadata");u.addOptionalMetadataHeaders(r);var d=function(e,r){e.directoryResult=null,e.error||(e.directoryResult=new b(t),e.directoryResult.getPropertiesFromHeaders(e.response.headers));var n=function(e){a(e.error,e.directoryResult,e.response)};r(e,n)};this.performRequest(u,null,i,d)},n.prototype.generateSharedAccessSignature=function(e,t,r,n,a){if(!this.storageCredentials||!this.storageCredentials.generateSignedQueryString)throw new Error(h.CANNOT_CREATE_SAS_WITHOUT_ACCOUNT_KEY);m.validateArgs("generateSharedAccessSignature",function(t){t.string(e,"share"),t.shareNameIsValid(e),t.object(n,"sharedAccessPolicy")});var o=v.ResourceTypes.SHARE;r?(m.validateArgs("generateSharedAccessSignature",function(e){e.stringAllowEmpty(t,"directory"),e.string(r,"file")}),o=v.ResourceTypes.FILE):t="",n.AccessPolicy&&(f.objectIsNull(n.AccessPolicy.Start)||(u.isDate(n.AccessPolicy.Start)||(n.AccessPolicy.Start=new Date(n.AccessPolicy.Start)),n.AccessPolicy.Start=f.truncatedISO8061Date(n.AccessPolicy.Start)),f.objectIsNull(n.AccessPolicy.Expiry)||(u.isDate(n.AccessPolicy.Expiry)||(n.AccessPolicy.Expiry=new Date(n.AccessPolicy.Expiry)),n.AccessPolicy.Expiry=f.truncatedISO8061Date(n.AccessPolicy.Expiry)));var i=s(e,t,r,!0);return this.storageCredentials.generateSignedQueryString(S.ServiceType.File,i,n,null,{headers:a,resourceType:o})},n.prototype.getUrl=function(e,t,r,n,a){m.validateArgs("getUrl",function(r){r.string(e,"share"),r.stringAllowEmpty(t,"directory"),r.shareNameIsValid(e)});var l;l=f.objectIsNull(a)||a!==!1?this.host.primaryHost:this.host.secondaryHost,l=f.trimPortFromUri(l),l&&l.lastIndexOf("/")!==l.length-1&&(l+="/");var u=s(e,t,r);return i.resolve(l,i.format({pathname:this._getPath(u),query:o.parse(n)}))},n.prototype.getFileProperties=function(e,t,r,n,a){var o;f.normalizeArgs(n,a,function(e,t){o=e,a=t}),m.validateArgs("getFileProperties",function(n){n.string(e,"share"),n.stringAllowEmpty(t,"directory"),n.string(r,"file"),n.shareNameIsValid(e),n.callback(a)});var i=c(!0,{},o),l=s(e,t,r),u=E.head(l),d=this,p=function(n,s){n.fileResult=null,n.error||(n.fileResult=new P(e,t,r),n.fileResult.metadata=d.parseMetadataHeaders(n.response.headers),n.fileResult.getPropertiesFromHeaders(n.response.headers,!0));var o=function(e){a(e.error,e.fileResult,e.response)};s(n,o)};this.performRequest(u,null,i,p)},n.prototype.getFileMetadata=function(e,t,r,n,a){var o;f.normalizeArgs(n,a,function(e,t){o=e,a=t}),m.validateArgs("getFileMetadata",function(n){n.string(e,"share"),n.stringAllowEmpty(t,"directory"),n.string(r,"file"),n.shareNameIsValid(e),n.callback(a)});var i=c(!0,{},o),l=s(e,t,r),u=E.head(l).withQueryOption(I.COMP,"metadata"),d=this,p=function(n,s){n.fileResult=null,n.error||(n.fileResult=new P(e,t,r),n.fileResult.metadata=d.parseMetadataHeaders(n.response.headers),n.fileResult.getPropertiesFromHeaders(n.response.headers));var o=function(e){a(e.error,e.fileResult,e.response)};s(n,o)};this.performRequest(u,null,i,p)},n.prototype.setFileProperties=function(e,t,r,n,a,o){var i;f.normalizeArgs(a,o,function(e,t){i=e,o=t}),m.validateArgs("setFileProperties",function(n){n.string(e,"share"),n.stringAllowEmpty(t,"directory"),n.string(r,"file"),n.shareNameIsValid(e),n.callback(o)});var l=c(!0,{contentSettings:n,contentLength:n.contentLength},i),u=s(e,t,r),d=E.put(u).withQueryOption(I.COMP,"properties");P.setProperties(d,l);var p=function(n,s){n.fileResult=null,n.error||(n.fileResult=new P(e,t,r),n.fileResult.getPropertiesFromHeaders(n.response.headers));var a=function(e){o(e.error,e.fileResult,e.response)};s(n,a)};this.performRequest(d,null,l,p)},n.prototype.setFileMetadata=function(e,t,r,n,a,o){var i;f.normalizeArgs(a,o,function(e,t){i=e,o=t}),m.validateArgs("setFileMetadata",function(s){s.string(e,"share"),s.stringAllowEmpty(t,"directory"),s.string(r,"file"),s.shareNameIsValid(e),s.object(n,"metadata"),s.callback(o)});var l=c(!0,{},i),u=s(e,t,r),d=E.put(u).withQueryOption(I.COMP,"metadata");d.addOptionalMetadataHeaders(n);var p=function(n,s){n.fileResult=null,n.error||(n.fileResult=new P(e,t,r),n.fileResult.getPropertiesFromHeaders(n.response.headers));var a=function(e){o(e.error,e.fileResult,e.response)};s(n,a)};this.performRequest(d,null,l,p)},n.prototype.resizeFile=function(e,t,r,n,a,o){var i;f.normalizeArgs(a,o,function(e,t){i=e,o=t}),m.validateArgs("resizeFile",function(s){s.string(e,"share"),s.stringAllowEmpty(t,"directory"),s.string(r,"file"),s.shareNameIsValid(e),s.value(n),s.callback(o)});var l=c(!0,{},i),u=s(e,t,r),d=E.put(u).withQueryOption(I.COMP,"properties");d.withHeader(A.FILE_CONTENT_LENGTH,n);var p=function(n,s){n.fileResult=null,n.error||(n.fileResult=new P(e,t,r),n.fileResult.getPropertiesFromHeaders(n.response.headers));var a=function(e){o(e.error,e.fileResult,e.response)};s(n,a)};this.performRequest(d,null,l,p)},n.prototype.doesFileExist=function(e,t,r,n,s){this._doesFileExist(e,t,r,!1,n,s)},n.prototype.createFile=function(e,t,r,n,a,o){var i;f.normalizeArgs(a,o,function(e,t){i=e,o=t}),m.validateArgs("createFile",function(s){s.string(e,"share"),s.stringAllowEmpty(t,"directory"),s.string(r,"file"),s.shareNameIsValid(e),s.value(n),s.callback(o)});var l=s(e,t,r),u=c(!0,{},i),d=E.put(l).withHeader(A.TYPE,"file").withHeader(A.FILE_CONTENT_LENGTH,n);P.setProperties(d,u);var p=function(n,s){n.fileResult=null,n.error||(n.fileResult=new P(e,t,r),n.fileResult.getPropertiesFromHeaders(n.response.headers));var a=function(e){o(e.error,e.fileResult,e.response)};s(n,a)};this.performRequest(d,null,u,p)},n.prototype.deleteFile=function(e,t,r,n,a){var o;f.normalizeArgs(n,a,function(e,t){o=e,a=t}),m.validateArgs("deleteFile",function(n){n.string(e,"share"),n.stringAllowEmpty(t,"directory"),n.string(r,"file"),n.shareNameIsValid(e),n.callback(a)});var i=c(!0,{},o),l=s(e,t,r),u=E.del(l),d=function(e,t){var r=function(e){a(e.error,e.response)};t(e,r)};this.performRequest(u,null,i,d)},n.prototype.deleteFileIfExists=function(e,t,r,n,s){var a;f.normalizeArgs(n,s,function(e,t){a=e,s=t}),m.validateArgs("deleteFileIfExists",function(n){n.string(e,"share"),n.stringAllowEmpty(t,"directory"),n.string(r,"file"),n.shareNameIsValid(e),n.callback(s)});var o=c(!0,{},a),i=this;i._doesFileExist(e,t,r,!0,o,function(n,a,l){n?s(n,a.exists,l):a.exists?i.deleteFile(e,t,r,o,function(e,t){var r;e?e&&e.statusCode===S.HttpConstants.HttpResponseCodes.NotFound&&e.code===S.FileErrorCodeStrings.FILE_NOT_FOUND&&(r=!1,e=null,t.isSuccessful=!0):r=!0,s(e,r,t)}):(l.isSuccessful=!0,s(n,!1,l))})},n.prototype.getFileToText=function(e,t,r,n,a){var o;f.normalizeArgs(n,a,function(e,t){o=e,a=t}),m.validateArgs("getFileToText",function(n){n.string(e,"share"),n.stringAllowEmpty(t,"directory"),n.string(r,"file"),n.shareNameIsValid(e),n.callback(a)});var i=c(!0,{},o),l=s(e,t,r),u=E.get(l).withRawResponse();P.setHeaders(u,i),this._setRangeContentMD5Header(u,i);var d=this,p=function(n,s){n.text=null,n.fileResult=null,n.error||(n.fileResult=new P(e,t,r),n.fileResult.getPropertiesFromHeaders(n.response.headers,!0),n.fileResult.metadata=d.parseMetadataHeaders(n.response.headers),n.text=n.response.body,d._validateLengthAndMD5(i,n));var o=function(e){a(e.error,e.text,e.fileResult,e.response)};s(n,o)};this.performRequest(u,null,i,p)},n.prototype.getFileToLocalFile=function(e,t,r,n,s,o){var i;f.normalizeArgs(s,o,function(e,t){i=e,o=t}),i.speedSummary=i.speedSummary||new y(r),m.validateArgs("getFileToLocalFile",function(s){s.string(e,"share"),s.stringAllowEmpty(t,"directory"),s.string(r,"file"),s.string(n,"localFileName"),s.shareNameIsValid(e),s.callback(o)});var l=c(!0,{},i),u=a.createWriteStream(n);return this.getFileToStream(e,t,r,u,l,function(e,t,r){e&&(u.close&&u.close(),f.pathExistsSync(n)&&a.unlink(n,function(){o(e,t,r)})),o(e,t,r)}),l.speedSummary},n.prototype.createReadStream=function(e,t,r,n,s){var a;f.normalizeArgs(n,s,function(e,t){a=e,s=t}),m.validateArgs("createReadStream",function(n){n.string(e,"share"),n.stringAllowEmpty(t,"directory"),n.string(r,"file"),n.shareNameIsValid(e)});var o=c(!0,{},a),i=new _(o);return this.getFileToStream(e,t,r,i,o,function(e,t,r){e&&i.emit("error",e),s&&s(e,t,r)}),i},n.prototype.getFileToStream=function(e,t,r,n,s,a){var o;f.normalizeArgs(s,a,function(e,t){o=e,a=t}),o.speedSummary=o.speedSummary||new y(r),m.validateArgs("getFileToStream",function(s){s.string(e,"share"),s.stringAllowEmpty(t,"directory"),s.string(r,"file"),s.object(n,"writeStream"),s.shareNameIsValid(e),s.callback(a)});var i=c(!0,{},o),l={timeoutIntervalInMs:i.timeoutIntervalInMs,clientRequestTimeoutInMs:i.clientRequestTimeoutInMs,accessConditions:i.accessConditions};if(i.skipSizeCheck)this._getFileToStream(e,t,r,n,i,a);else{var u=this;this.getFileProperties(e,t,r,l,function(s,o){if(s)a(s);else{var l;if(i.rangeStart){var c=o.contentLength-1,d=i.rangeEnd?Math.min(i.rangeEnd,c):c;l=d-i.rangeStart+1}else l=o.contentLength;i.speedSummary.totalSize=l,l>u.singleFileThresholdInBytes?(f.setObjectInnerPropertyValue(i,["contentSettings","contentMD5"],f.tryGetValueChain(o,["contentSettings","contentMD5"],null)),u._getFileToRangeStream(e,t,r,n,i,a)):u._getFileToStream(e,t,r,n,i,a)}})}return i.speedSummary},n.prototype.listRanges=function(e,t,r,n,a){var o;f.normalizeArgs(n,a,function(e,t){o=e,a=t}),m.validateArgs("listRanges",function(n){n.string(e,"share"),n.stringAllowEmpty(t,"directory"),n.string(r,"file"),n.shareNameIsValid(e),n.callback(a)});var i=s(e,t,r),l=c(!0,{},o),d=E.get(i).withQueryOption(I.COMP,"rangelist");P.setHeaders(d,l);var p=function(e,t){if(e.ranges=null,!e.error){e.ranges=[];var r=[];e.response.body.Ranges.Range&&(r=e.response.body.Ranges.Range,u.isArray(r)||(r=[r])),r.forEach(function(t){var r={start:parseInt(t.Start,10),end:parseInt(t.End,10)};e.ranges.push(r)})}var n=function(e){a(e.error,e.ranges,e.response)};t(e,n)};this.performRequest(d,null,l,p)},n.prototype.clearRange=function(e,t,r,n,s,a,o){var i;f.normalizeArgs(a,o,function(e,t){i=e,o=t}),m.validateArgs("clearRange",function(a){a.string(e,"share"),a.stringAllowEmpty(t,"directory"),a.string(r,"file"),a.shareNameIsValid(e),a.value(n),a.value(s),a.callback(o)});var l=c(!0,{},i),u=this._updateFilesImpl(e,t,r,n,s,v.RangeWriteOptions.CLEAR,l),d=function(n,s){n.fileResult=null,n.error||(n.fileResult=new P(e,t,r),n.fileResult.getPropertiesFromHeaders(n.response.headers));var a=function(e){o(e.error,e.fileResult,e.response)};s(n,a)};this.performRequest(u,null,l,d)},n.prototype.createRangesFromStream=function(e,t,r,n,s,a,o,i){var l;f.normalizeArgs(o,i,function(e,t){l=e,i=t}),m.validateArgs("createRangesFromStream",function(o){o.string(e,"share"),o.stringAllowEmpty(t,"directory"),o.string(r,"file"),o.object(n,"readStream"),o.shareNameIsValid(e),o.value(s),o.value(a),o.callback(i)});var u=c(!0,{},l),d=f.objectIsNull(u.transactionalContentMD5)&&u.useTransactionalMD5===!0,p=a-s+1;if(p>v.MAX_UPDATE_FILE_SIZE)throw new Error(h.INVALID_FILE_RANGE_FOR_UPDATE);var g=this;d?f.calculateMD5(n,p,u,function(n,o){u.transactionalContentMD5=o,g._createRanges(e,t,r,n,null,s,a,u,i)}):g._createRanges(e,t,r,null,n,s,a,u,i)},n.prototype.createFileFromText=function(e,t,n,s,a,o){var i;f.normalizeArgs(a,o,function(e,t){i=e,o=t}),m.validateArgs("createFileFromText",function(r){r.string(e,"share"),r.stringAllowEmpty(t,"directory"),r.string(n,"file"),r.exists(s,"text"),r.shareNameIsValid(e),r.callback(o)});var l=c(!0,{},i),u=r.isBuffer(s)?s.length:r.byteLength(s);if(u>v.MAX_UPDATE_FILE_SIZE)throw new Error(h.INVALID_FILE_LENGTH);l.storeFileContentMD5&&f.objectIsNull(f.tryGetValueChain(l,["contentSettings","contentMD5"],null))&&f.setObjectInnerPropertyValue(l,["contentSettings","contentMD5"],f.getContentMd5(s));var d=this;this.createFile(e,t,n,u,l,function(r){r?o(r):d._createRanges(e,t,n,s,null,0,u-1,l,o)})},n.prototype.createFileFromLocalFile=function(e,t,r,n,s,o){var i;f.normalizeArgs(s,o,function(e,t){i=e,o=t}),m.validateArgs("createFileFromLocalFile",function(s){s.string(e,"share"),s.stringAllowEmpty(t,"directory"),s.string(r,"file"),s.string(n,"localFileName"),s.shareNameIsValid(e),s.callback(o)});var l=c(!0,{},i);l.speedSummary=l.speedSummary||new y(r);var u=this;return a.stat(n,function(s,a){s?o(s):u.createFile(e,t,r,a.size,l,function(s){if(s)o(s);else{var i=new w(n,{calcContentMd5:l.storeFileContentMD5});u._createFileFromChunkStream(e,t,r,i,a.size,l,o)}})}),l.speedSummary},n.prototype.createFileFromStream=function(e,t,r,n,s,a,o){var i;f.normalizeArgs(a,o,function(e,t){i=e,o=t}),m.validateArgs("createFileFromStream",function(a){a.string(e,"share"),a.stringAllowEmpty(t,"directory"),a.string(r,"file"),a.object(n,"stream"),a.value(s,"streamLength"),a.shareNameIsValid(e),a.callback(o)});var l=c(!0,{},i);l.speedSummary=l.speedSummary||new y(r),n.pause();var u=this;return this.createFile(e,t,r,s,l,function(a){if(a)o(a);else{var i=new F(n,{calcContentMd5:l.storeFileContentMD5});u._createFileFromChunkStream(e,t,r,i,s,l,o)}}),l.speedSummary},n.prototype.createWriteStreamToExistingFile=function(e,t,r,n,s){var a;f.normalizeArgs(n,s,function(e,t){a=e,s=t}),m.validateArgs("createWriteStreamToExistingFile",function(n){n.string(e,"share"),n.stringAllowEmpty(t,"directory"),n.string(r,"file"),n.shareNameIsValid(e)});var o=c(!0,{},a),i=new _({calcContentMd5:o.storeFileContentMD5});return this._createFileFromChunkStream(e,t,r,i,null,o,function(e,t,r){e&&i.emit("error",e),s&&s(e,t,r)}),i},n.prototype.createWriteStreamToNewFile=function(e,t,r,n,s,a){var o;f.normalizeArgs(s,a,function(e,t){o=e,a=t}),m.validateArgs("createWriteStreamToNewFile",function(s){s.string(e,"share"),s.stringAllowEmpty(t,"directory"),s.string(r,"file"),s.value(n,"length"),s.shareNameIsValid(e)});var i=c(!0,{},o),l=new _({calcContentMd5:i.storeFileContentMD5});l.pause();var u=this;return this.createFile(e,t,r,n,i,function(n){n?(l.emit("error",n),a(n)):(l.resume(),u._createFileFromChunkStream(e,t,r,l,null,i,function(e,t,r){e&&l.emit("error",e),a&&a(e,t,r)}))}),l},n.prototype.startCopyFile=function(e,t,r,n,a,o){var i;f.normalizeArgs(a,o,function(e,t){i=e,o=t}),m.validateArgs("startCopyFile",function(e){e.string(t,"targetShare"),e.stringAllowEmpty(r,"targetDirectory"),e.string(n,"targetFile"),e.shareNameIsValid(t),e.callback(o)});var l=s(t,r,n),u=c(!0,{},i),d=E.put(l).withHeader(A.COPY_SOURCE,e).addOptionalMetadataHeaders(u.metadata),p=function(e,s){e.fileResult=null,e.error||(e.fileResult=new P(t,r,n),e.fileResult.getPropertiesFromHeaders(e.response.headers,!0),u.metadata&&(e.fileResult.metadata=u.metadata));var a=function(e){o(e.error,e.fileResult,e.response)};s(e,a)};this.performRequest(d,null,u,p)},n.prototype.abortCopyFile=function(e,t,r,n,a,o){var i;f.normalizeArgs(a,o,function(e,t){i=e,o=t}),m.validateArgs("abortCopyFile",function(n){n.string(e,"share"),n.stringAllowEmpty(t,"directory"),n.string(r,"file"),n.shareNameIsValid(e),n.callback(o)});var l=s(e,t,r),u=c(!0,{},i),d=E.put(l).withQueryOption(I.COPY_ID,n).withQueryOption(I.COMP,"copy").withHeader(A.COPY_ACTION,"abort"),p=function(e,t){var r=function(e){o(e.error,e.response)};t(e,r)};this.performRequest(d,null,u,p)},n.prototype._createRanges=function(e,t,r,n,s,a,o,i,l){var u=this._updateFilesImpl(e,t,r,a,o,v.RangeWriteOptions.UPDATE,i);!f.objectIsNull(n)&&f.objectIsNull(i.transactionalContentMD5)&&i.useTransactionalMD5===!0&&u.withHeader(A.CONTENT_MD5,f.getContentMd5(n));var c=function(n,s){n.fileResult=null,n.error||(n.fileResult=new P(e,t,r),n.fileResult.getPropertiesFromHeaders(n.response.headers));var a=function(e){l(e.error,e.fileResult,e.response)};s(n,a)};f.objectIsNull(n)?this.performRequestOutputStream(u,s,i,c):this.performRequest(u,n,i,c)},n.prototype._createFileFromChunkStream=function(e,t,r,n,s,a,o){this.logger.debug(l.format("_createFileFromChunkStream for file %s",r));var i="_createRanges",u=v.DEFAULT_WRITE_SIZE_IN_BYTES,d=f.tryGetValueChain(a,["contentSettings","contentMD5"],null);this._setOperationExpiryTime(a);
var p=a.speedSummary||new y;p.totalSize=s;var g=a.parallelOperationThreadCount||this.parallelOperationThreadCount,m=new N(u,g,{logger:this.logger});n._stream&&n._stream.setMemoryAllocator&&n._stream.setMemoryAllocator(m);var R=new C(i,{logger:this.logger});R.setConcurrency(g);var E={timeoutIntervalInMs:a.timeoutIntervalInMs,clientRequestTimeoutInMs:a.clientRequestTimeoutInMs,operationExpiryTime:a.operationExpiryTime},S=this;return n.on("data",function(s,o){var c=null,d=!1,g=p.getAutoIncrementFunction(s.length);if(s.length>u)throw new Error(l.format(h.EXCEEDED_SIZE_LIMITATION,u,s.length));if(a.useTransactionalMD5){var y=f.getContentMd5(s);E.transactionalContentMD5=y}f.isBufferAllZero(s)?(S.logger.debug(l.format("Skip upload data from %s bytes to %s bytes to file %s",o.start,o.end,r)),p.increment(s.length)):c=new C.RestOperation(S,i,e,t,r,s,null,o.start,o.end,E,function(e){e||g(),m.releaseBuffer(s),s=null}),c&&(d=R.addOperation(c),c=null,d&&(S.logger.debug("file stream paused"),n.pause()))}),n.on("end",function(){S.logger.debug(l.format("File read stream ended for file %s",r)),R.enableComplete()}),R.on("drain",function(){S.logger.debug("File stream resume"),n.resume()}),R.on("end",function(s){if(S.logger.debug("batch operations commited"),s)return void o(s);d?a.contentSettings.contentMD5=d:a.storeFileContentMD5&&f.setObjectInnerPropertyValue(a,["contentSettings","contentMD5"],n.getContentMd5("base64"));var i=c(!1,a.contentSettings,{contentLength:a.streamLength});S.setFileProperties(e,t,r,i,function(e,t,r){n.finish(),o(e,t,r)})}),p},n.prototype._getFileToStream=function(e,t,r,n,a,o){var i;f.normalizeArgs(a,o,function(e,t){i=e,o=t}),m.validateArgs("_getFileToStream",function(s){s.string(e,"share"),s.stringAllowEmpty(t,"directory"),s.string(r,"file"),s.object(n,"writeStream"),s.shareNameIsValid(e),s.callback(o)});var l=c(!0,{},i),u=s(e,t,r),d=E.get(u).withRawResponse();P.setHeaders(d,l),this._setRangeContentMD5Header(d,l);var p=this,g=function(n,s){n.fileResult=null,n.error||(n.fileResult=new P(e,t,r),n.fileResult.metadata=p.parseMetadataHeaders(n.response.headers),n.fileResult.getPropertiesFromHeaders(n.response.headers,!0),p._validateLengthAndMD5(l,n));var a=function(e){o(e.error,e.fileResult,e.response)};s(n,a)};this.performRequestInputStream(d,null,n,l,g)},n.prototype._getFileToRangeStream=function(e,t,r,n,s,a){var o;f.normalizeArgs(s,a,function(e,t){o=e,a=t}),m.validateArgs("_getFileToRangeStream",function(s){s.string(e,"share"),s.stringAllowEmpty(t,"directory"),s.string(r,"file"),s.object(n,"writeStream"),s.shareNameIsValid(e),s.callback(a)});var i=o.speedSummary||new y(r),u=o.parallelOperationThreadCount||this.parallelOperationThreadCount,c=new C("getfile",{callbackInOrder:!0,logger:this.logger});c.setConcurrency(u);var d=new O(this,e,t,r,o),p=this,h=!o.disableContentMD5Validation,R=null;h&&(R=(new g).createMd5Hash());var E=null,S=null;d.on("range",function(s){i.totalSize||(i.totalSize=d.rangeSize);var a={rangeStart:s.start,rangeEnd:s.end,responseEncoding:null},u=s.size;if(a.timeoutIntervalInMs=o.timeoutIntervalInMs,a.clientRequestTimeoutInMs=o.clientRequestTimeoutInMs,a.useTransactionalMD5=o.useTransactionalMD5,0===s.dataSize){var g=i.getAutoIncrementFunction(u),h=new C.CommonOperation(C.noOperation,function(e){if(!e){var t=f.writeZerosToStream(n,u,R,g);p.logger.debug(l.format("Write %s bytes Zero from %s to %s",u,s.start,s.end)),t||(p.logger.debug("Write stream is full and pause batch operation"),c.pause())}});return void c.addOperation(h)}if(!(s.start>s.end)){var m=new C.RestOperation(p,"getFileToText",e,t,r,a,function(e,t,r,s){if(!e){u!==t.length&&p.logger.warn(l.format("Request %s bytes, but server returns %s bytes",u,t.length)),E||(E=r),S||(S=s);var a=i.getAutoIncrementFunction(t.length),o=n.write(t,a);o||(p.logger.debug("Write stream is full and pause batch operation"),c.pause()),R&&R.update(t),t=null}}),y=c.addOperation(m);y&&(p.logger.debug("Pause range stream"),d.pause())}}),d.on("end",function(){p.logger.debug("Range stream has ended."),c.enableComplete()}),c.on("drain",function(){p.logger.debug("Resume range stream"),d.resume()}),n.on("drain",function(){p.logger.debug("Resume batch operations"),c.resume()}),c.on("end",function(e){p.logger.debug("Download completed!"),e?a(e):n.end(function(){p.logger.debug("Write stream has ended"),n.close&&n.close(),E||(E={}),f.setObjectInnerPropertyValue(E,["contentSettings","contentMD5"],f.tryGetValueChain(o,["contentSettings","contentMD5"],null)),E.clientSideContentMD5=null,R&&(E.clientSideContentMD5=R.digest("base64")),a(e,E,S)})});var v={timeoutIntervalInMs:o.timeoutIntervalInMs,clientRequestTimeoutInMs:o.clientRequestTimeoutInMs};return d.list(v),i},n.prototype._setRangeContentMD5Header=function(e,t){if(!f.objectIsNull(t.rangeStart)&&t.useTransactionalMD5){if(f.objectIsNull(t.rangeEnd))throw new L(l.format(h.ARGUMENT_NULL_OR_EMPTY,t.rangeEndHeader));var r=parseInt(t.rangeEnd,10)-parseInt(t.rangeStart,10)+1;if(r>v.MAX_RANGE_GET_SIZE_WITH_MD5)throw new Error(h.INVALID_RANGE_FOR_MD5);e.withHeader(A.RANGE_GET_CONTENT_MD5,"true")}},n.prototype._updateFilesImpl=function(e,t,r,n,a,o,i){var l=s(e,t,r),u=E.put(l).withQueryOption(I.COMP,"range").withHeader(A.CONTENT_TYPE,"application/octet-stream").withHeader(A.FILE_WRITE,o);if(i.rangeStart=n,i.rangeEnd=a,P.setHeaders(u,i),o===v.RangeWriteOptions.UPDATE){var c=a-n+1;u.withHeader(A.CONTENT_LENGTH,c)}else u.withHeader(A.CONTENT_LENGTH,0);return u},n.prototype._validateLengthAndMD5=function(e,t){var n,s=t.response.headers[S.HeaderConstants.CONTENT_MD5];f.objectIsNull(t.response.headers[S.HeaderConstants.CONTENT_LENGTH])||(n=parseInt(t.response.headers[S.HeaderConstants.CONTENT_LENGTH],10)),f.objectIsNull(e.disableContentMD5Validation)&&(e.disableContentMD5Validation=!1),e.disableContentMD5Validation===!1&&e.useTransactionalMD5===!0&&f.objectIsNull(s)&&(t.error=new Error(h.MD5_NOT_PRESENT_ERROR),t.retryable=!1),f.objectIsNull(t.length)&&("string"==typeof t.response.body?t.length=r.byteLength(t.response.body):r.isBuffer(t.response.body)&&(t.length=t.response.body.length)),f.objectIsNull(n)||t.length===n||(t.error=new Error(h.CONTENT_LENGTH_MISMATCH),t.retryable=!1),e.disableContentMD5Validation===!1&&f.objectIsNull(t.contentMD5)&&(t.contentMD5=f.getContentMd5(t.response.body)),e.disableContentMD5Validation!==!1||f.objectIsNull(s)||s===t.contentMD5||(t.error=new Error(l.format(h.HASH_MISMATCH,s,t.contentMD5)),t.retryable=!1)},n.prototype._doesFileExist=function(e,t,r,n,a,o){var i;f.normalizeArgs(a,o,function(e,t){i=e,o=t}),m.validateArgs("FileExists",function(n){n.string(e,"share"),n.stringAllowEmpty(t,"directory"),n.string(r,"file"),n.shareNameIsValid(e),n.callback(o)});var l=c(!0,{},i),u=s(e,t,r),d=E.head(u),p=function(n,s){n.fileResult=new P(e,t,r),n.error?n.error&&n.error.statusCode===S.HttpConstants.HttpResponseCodes.NotFound&&(n.error=null,n.fileResult.exists=!1,n.response.isSuccessful=!0):(n.fileResult.exists=!0,n.fileResult.getPropertiesFromHeaders(n.response.headers));var a=function(e){o(e.error,e.fileResult,e.response)};s(n,a)};this.performRequest(d,null,l,p)},n.prototype._doesDirectoryExist=function(e,t,r,n,a){var o;f.normalizeArgs(n,a,function(e,t){o=e,a=t}),m.validateArgs("directoryExists",function(r){r.string(e,"share"),r.stringAllowEmpty(t,"directory"),r.shareNameIsValid(e),r.callback(a)});var i=c(!0,{},o),l=E.head(s(e,t)).withQueryOption(I.RESTYPE,"directory"),u=this,d=function(e,r){e.directoryResult=new b(t),e.directoryResult.exists=!1,e.error?e.error&&e.error.statusCode===S.HttpConstants.HttpResponseCodes.NotFound&&(e.error=null,e.response.isSuccessful=!0):(e.directoryResult.exists=!0,e.directoryResult.metadata=u.parseMetadataHeaders(e.response.headers),e.directoryResult.getPropertiesFromHeaders(e.response.headers));var n=function(e){a(e.error,e.directoryResult,e.response)};r(e,n)};this.performRequest(l,null,i,d)},n.prototype._doesShareExist=function(e,t,r,n){var s;f.normalizeArgs(r,n,function(e,t){s=e,n=t}),m.validateArgs("shareExists",function(t){t.string(e,"share"),t.shareNameIsValid(e),t.callback(n)});var a=c(!0,{},s),o=E.head(e).withQueryOption(I.RESTYPE,"share"),i=function(t,r){t.shareResult=new M(e),t.shareResult.exists=!1,t.error?t.error&&t.error.statusCode===S.HttpConstants.HttpResponseCodes.NotFound&&(t.error=null,t.response.isSuccessful=!0):(t.shareResult.exists=!0,t.shareResult.getPropertiesFromHeaders(t.response.headers));var s=function(e){n(e.error,e.shareResult,e.response)};r(t,s)};this.performRequest(o,null,a,i)},n.SpeedSummary=y,t.exports=n}).call(this,e("buffer").Buffer)},{"../../common/errors/errors":7,"./../../common/common":5,"./../../common/md5-wrapper":12,"./internal/filerangestream":49,"./models/directoryresult":50,"./models/fileresult":51,"./models/shareresult":52,buffer:"buffer",extend:431,fs:69,path:399,querystring:404,underscore:577,url:424,util:"util"}],52:[function(e,t,r){function n(e){this.name=e}var s=e("./../../../common/common"),a=s.util,o=s.Constants,i=o.HeaderConstants;n.parse=function(e,t){var r=new n(t);for(var s in e)if(e.hasOwnProperty(s))if("Properties"===s)a.setPropertyValueFromXML(r,e[s],!0);else if("Metadata"===s||"ShareStats"===s){var o=a.normalizePropertyNameFromXML(s);r[o]={},a.setPropertyValueFromXML(r[o],e[s],"ShareStats"===s)}else r[s.toLowerCase()]=e[s];return r},n.prototype.getPropertiesFromHeaders=function(e){var t=this,r=function(r,n){!t[r]&&e[n.toLowerCase()]&&(t[r]=e[n.toLowerCase()])};r("etag",i.ETAG),r("lastModified",i.LAST_MODIFIED),r("requestId",i.REQUEST_ID),r("quota",i.SHARE_QUOTA)},t.exports=n},{"./../../../common/common":5}],51:[function(e,t,r){function n(e,t,r){this.share=e,this.directory=t,this.name=r}var s=e("underscore"),a=e("./../../../common/common"),o=a.util,i=a.Constants,l=i.HeaderConstants;n.parse=function(e){var t=new n;for(var r in e)"Properties"===r?o.setPropertyValueFromXML(t,e[r],!0):t[r.toLowerCase()]=e[r];return t};var u={acceptRanges:"ACCEPT_RANGES",contentLength:"CONTENT_LENGTH",contentRange:"CONTENT_RANGE","contentSettings.contentType":"CONTENT_TYPE","contentSettings.contentEncoding":"CONTENT_ENCODING","contentSettings.contentLanguage":"CONTENT_LANGUAGE","contentSettings.cacheControl":"CACHE_CONTROL","contentSettings.contentDisposition":"CONTENT_DISPOSITION","contentSettings.contentMD5":"CONTENT_MD5","contentSettings.fileContentMD5":"FILE_CONTENT_MD5","copy.id":"COPY_ID","copy.status":"COPY_STATUS","copy.source":"COPY_SOURCE","copy.progress":"COPY_PROGRESS","copy.completionTime":"COPY_COMPLETION_TIME","copy.statusDescription":"COPY_STATUS_DESCRIPTION"};n.prototype.getPropertiesFromHeaders=function(e,t){var r=this,n=function(t,n){if(!o.tryGetValueChain(r,t.split("."),null)&&e[n.toLowerCase()]&&(o.setObjectInnerPropertyValue(r,t.split("."),e[n.toLowerCase()]),"copy.progress"===t)){var s=o.parseCopyProgress(r.copy.progress);r.copy.bytesCopied=parseInt(s.bytesCopied),r.copy.totalBytes=parseInt(s.totalBytes)}};n("contentSettings.contentMD5",l.FILE_CONTENT_MD5),n("etag",l.ETAG),n("lastModified",l.LAST_MODIFIED),n("requestId",l.REQUEST_ID),t&&s.chain(u).pairs().each(function(e){var t=e[0],r=l[e[1]];n(t,r)})},n.setHeaders=function(e,t){var r=function(r,n){var s=o.tryGetValueChain(t,n.split("."),null);s&&e.withHeader(r,s)};if(t&&(r(l.CONTENT_MD5,"transactionalContentMD5"),r(l.CONTENT_LENGTH,"contentLength"),!o.objectIsNull(t.rangeStart))){var n="bytes="+t.rangeStart+"-";o.objectIsNull(t.rangeEnd)||(n+=t.rangeEnd),e.withHeader(l.STORAGE_RANGE,n)}},n.setProperties=function(e,t){var r=function(r,n){var s=o.tryGetValueChain(t,n.split("."),null);s&&e.withHeader(r,s)};t&&(r(l.FILE_CONTENT_LENGTH,"contentLength"),r(l.FILE_CONTENT_TYPE,"contentSettings.contentType"),r(l.FILE_CONTENT_ENCODING,"contentSettings.contentEncoding"),r(l.FILE_CONTENT_LANGUAGE,"contentSettings.contentLanguage"),r(l.FILE_CONTENT_DISPOSITION,"contentSettings.contentDisposition"),r(l.FILE_CACHE_CONTROL,"contentSettings.cacheControl"),r(l.FILE_CONTENT_MD5,"contentSettings.contentMD5"),t.metadata&&e.addOptionalMetadataHeaders(t.metadata))},t.exports=n},{"./../../../common/common":5,underscore:577}],50:[function(e,t,r){function n(e){this.name=e}var s=e("./../../../common/common").Constants.HeaderConstants;n.parse=function(e){return new n(e.Name)},n.prototype.getPropertiesFromHeaders=function(e){var t=this,r=function(r,n){!t[r]&&e[n.toLowerCase()]&&(t[r]=e[n.toLowerCase()])};r("etag",s.ETAG),r("lastModified",s.LAST_MODIFIED),r("requestId",s.REQUEST_ID)},t.exports=n},{"./../../../common/common":5}],49:[function(e,t,r){function n(e,t,r,s,a){n.super_.call(this,e,null,null,a),this._lengthHeader=o.HeaderConstants.FILE_CONTENT_LENGTH,a.minRangeSize?this._minRangeSize=a.minRangeSize:this._minRangeSize=o.FileConstants.MIN_WRITE_FILE_SIZE_IN_BYTES,a.maxRangeSize?this._maxRangeSize=a.maxRangeSize:this._maxRangeSize=o.FileConstants.DEFAULT_WRITE_SIZE_IN_BYTES,this._listFunc=e.listRanges,this._resourcePath.push(t),this._resourcePath.push(r),this._resourcePath.push(s)}var s=e("util"),a=e("./../../../common/streams/rangestream"),o=e("./../../../common/util/constants");s.inherits(n,a),t.exports=n},{"./../../../common/streams/rangestream":27,"./../../../common/util/constants":31,util:"util"}]},{},[2]);