// Azure Storage JavaScript Client Library 0.2.1-preview.3
// Copyright (c) Microsoft and contributors.  All rights reserved.

require=function e(t,r,s){function u(o,i){if(!r[o]){if(!t[o]){var a="function"==typeof require&&require;if(!i&&a)return a(o,!0);if(n)return n(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var c=r[o]={exports:{}};t[o][0].call(c.exports,function(e){var r=t[o][1][e];return u(r?r:e)},c,c.exports,e,t,r,s)}return r[o].exports}for(var n="function"==typeof require&&require,o=0;o<s.length;o++)u(s[o]);return u}({3:[function(e,t,r){var s=window.AzureStorage||{};s.generateDevelopmentStorageCredentials=function(e){var t="UseDevelopmentStorage=true;";return e&&(t+="DevelopmentStorageProxyUri="+e),t};var u=e("../lib/services/queue/queueservice");s.QueueService=u,s.QueueUtilities=e("../lib/services/queue/queueutilities"),s.QueueMessageEncoder=e("../lib/services/queue/queuemessageencoder"),s.createQueueService=function(e,t,r){return new u(e,t,r)},s.createQueueServiceWithSas=function(e,t){return new u(null,null,e,t)};var n=e("../lib/common/common"),o=n.StorageServiceClient,i=n.SharedKey;s.generateAccountSharedAccessSignature=function(e,t,r){var s=o.getStorageSettings(e,t),u=new i(s._name,s._key);return u.generateAccountSignedQueryString(r)},s.Constants=n.Constants,s.StorageUtilities=n.StorageUtilities,s.AccessCondition=n.AccessCondition,s.SR=n.SR,s.StorageServiceClient=o,s.Logger=n.Logger,s.WebResource=n.WebResource,s.Validate=n.validate,s.date=n.date,s.LinearRetryPolicyFilter=n.LinearRetryPolicyFilter,s.ExponentialRetryPolicyFilter=n.ExponentialRetryPolicyFilter,s.RetryPolicyFilter=n.RetryPolicyFilter,window.AzureStorage=s},{"../lib/common/common":5,"../lib/services/queue/queuemessageencoder":55,"../lib/services/queue/queueservice":56,"../lib/services/queue/queueutilities":57}],57:[function(e,t,r){r=t.exports;var s={SharedAccessPermissions:{READ:"r",ADD:"a",UPDATE:"u",PROCESS:"p"}};t.exports=s},{}],56:[function(e,t,r){(function(r){function s(e,t,r,u,n){var o=p.getStorageSettings(e,t,r,u,n);if(s.super_.call(this,o._name,o._key,o._queueEndpoint,o._usePathStyleUri,o._sasToken),this.anonymous)throw new Error(l.ANONYMOUS_ACCESS_BLOBSERVICE_ONLY);this.messageEncoder=new y.TextXmlQueueMessageEncoder}var u=e("util"),n=e("underscore"),o=e("extend"),i=e("./../../common/common"),a=i.util,l=i.SR,c=i.validate,p=i.StorageServiceClient,g=i.WebResource,d=i.Constants,f=d.QueryStringConstants,m=d.HeaderConstants,v=d.RequestLocationMode,E=e("./models/queueresult"),q=i.AclResult,R=e("./models/queuemessageresult"),y=e("./queuemessageencoder"),h=i.ServiceStatsParser;u.inherits(s,p),s.prototype.getServiceStats=function(e,t){var r;a.normalizeArgs(e,t,function(e,s){r=e,t=s}),c.validateArgs("getServiceStats",function(e){e.callback(t)});var s=o(!0,{},r),u=g.get().withQueryOption(f.COMP,"stats").withQueryOption(f.RESTYPE,"service");s.requestLocationMode=v.PRIMARY_OR_SECONDARY;var n=function(e,r){e.serviceStatsResult=null,e.error||(e.serviceStatsResult=h.parse(e.response.body.StorageServiceStats));var s=function(e){t(e.error,e.serviceStatsResult,e.response)};r(e,s)};this.performRequest(u,null,s,n)},s.prototype.getServiceProperties=function(e,t){return this.getAccountServiceProperties(e,t)},s.prototype.setServiceProperties=function(e,t,r){return this.setAccountServiceProperties(e,t,r)},s.prototype.listQueuesSegmented=function(e,t,r){this.listQueuesSegmentedWithPrefix(null,e,t,r)},s.prototype.listQueuesSegmentedWithPrefix=function(e,t,r,s){var u;a.normalizeArgs(r,s,function(e,t){u=e,s=t}),c.validateArgs("listQueuesSegmentedWithPrefix",function(e){e.callback(s)});var i=o(!0,{},u),l=g.get();l.withQueryOption(f.COMP,"list").withQueryOption(f.MAX_RESULTS,i.maxResults).withQueryOption(f.INCLUDE,i.include).withQueryOption(f.PREFIX,e),a.objectIsNull(t)||l.withQueryOption(f.MARKER,t.nextMarker),i.requestLocationMode=a.getNextListingLocationMode(t);var p=function(e,t){if(e.listQueuesResult=null,!e.error){e.listQueuesResult={entries:null,continuationToken:null},e.listQueuesResult.entries=[];var r=[];e.response.body.EnumerationResults.Queues&&e.response.body.EnumerationResults.Queues.Queue&&(r=e.response.body.EnumerationResults.Queues.Queue,n.isArray(r)||(r=[r]),r.forEach(function(t){var r=E.parse(t);e.listQueuesResult.entries.push(r)}),e.response.body.EnumerationResults.NextMarker&&(e.listQueuesResult.continuationToken={nextMarker:null,targetLocation:null},e.listQueuesResult.continuationToken.nextMarker=e.response.body.EnumerationResults.NextMarker,e.listQueuesResult.continuationToken.targetLocation=e.targetLocation))}var u=function(e){s(e.error,e.listQueuesResult,e.response)};t(e,u)};this.performRequest(l,null,i,p)},s.prototype.doesQueueExist=function(e,t,r){this._doesQueueExist(e,!1,t,r)},s.prototype.createQueue=function(e,t,r){var s;a.normalizeArgs(t,r,function(e,t){s=e,r=t}),c.validateArgs("createQueue",function(t){t.string(e,"queue"),t.queueNameIsValid(e),t.callback(r)});var u=o(!0,{},s),n=g.put(e);u&&n.addOptionalMetadataHeaders(u.metadata);var i=function(t,s){t.queueResult=null,t.error||(t.queueResult=new E(e),u&&u.metadata&&(t.queueResult.metadata=u.metadata));var n=function(e){r(e.error,e.queueResult,e.response)};s(t,n)};this.performRequest(n,null,u,i)},s.prototype.createQueueIfNotExists=function(e,t,r){var s;a.normalizeArgs(t,r,function(e,t){s=e,r=t}),c.validateArgs("createQueueIfNotExists",function(t){t.string(e,"queue"),t.queueNameIsValid(e),t.callback(r)});var u=o(!0,{},s),n=this;n._doesQueueExist(e,!0,u,function(t,s,o){var i=s.exists;s.created=!1,delete s.exists,t?r(t,s,o):i?(o.isSuccessful=!0,r(t,s,o)):n.createQueue(e,u,function(e,t,s){e?e&&e.statusCode===d.HttpConstants.HttpResponseCodes.Conflict&&e.code===d.QueueErrorCodeStrings.QUEUE_ALREADY_EXISTS&&(e=null,t.created=!1,s.isSuccessful=!0):t.created=!0,r(e,t,s)})})},s.prototype.deleteQueue=function(e,t,r){var s;a.normalizeArgs(t,r,function(e,t){s=e,r=t}),c.validateArgs("deleteQueue",function(t){t.string(e,"queue"),t.queueNameIsValid(e),t.callback(r)});var u=o(!0,{},s),n=g.del(e),i=function(e,t){var s=function(e){r(e.error,e.response)};t(e,s)};this.performRequest(n,null,u,i)},s.prototype.deleteQueueIfExists=function(e,t,r){var s;a.normalizeArgs(t,r,function(e,t){s=e,r=t}),c.validateArgs("deleteQueueIfExists",function(t){t.string(e,"queue"),t.queueNameIsValid(e),t.callback(r)});var u=o(!0,{},s),n=this;n._doesQueueExist(e,!0,u,function(t,s,o){t?r(t,s.exists,o):s.exists?n.deleteQueue(e,u,function(e,t){var s;e?e&&e.statusCode===d.HttpConstants.HttpResponseCodes.NotFound&&e.code===d.QueueErrorCodeStrings.QUEUE_NOT_FOUND&&(s=!1,e=null,t.isSuccessful=!0):s=!0,r(e,s,t)}):(o.isSuccessful=!0,r(t,!1,o))})},s.prototype.getQueueMetadata=function(e,t,r){var s;a.normalizeArgs(t,r,function(e,t){s=e,r=t}),c.validateArgs("getQueueMetadata",function(t){t.string(e,"queue"),t.queueNameIsValid(e),t.callback(r)});var u=o(!0,{},s),n=g.get(e).withQueryOption(f.COMP,"metadata");u.requestLocationMode=d.RequestLocationMode.PRIMARY_OR_SECONDARY;var i=this,l=function(t,s){t.queueResult=null,t.error||(t.queueResult=new E(e),t.queueResult.metadata=i.parseMetadataHeaders(t.response.headers),t.queueResult.getPropertiesFromHeaders(t.response.headers));var u=function(e){r(e.error,e.queueResult,e.response)};s(t,u)};this.performRequest(n,null,u,l)},s.prototype.setQueueMetadata=function(e,t,r,s){var u;a.normalizeArgs(r,s,function(e,t){u=e,s=t}),c.validateArgs("setQueueMetadata",function(t){t.string(e,"queue"),t.queueNameIsValid(e),t.callback(s)});var n=o(!0,{},u),i=g.put(e).withQueryOption(f.COMP,"metadata").addOptionalMetadataHeaders(t),l=function(r,u){r.queueResult=null,r.error||(r.queueResult=new E(e,t),r.queueResult.getPropertiesFromHeaders(r.response.headers));var n=function(e){s(e.error,e.queueResult,e.response)};u(r,n)};this.performRequest(i,null,n,l)},s.prototype.createMessage=function(e,t,s,u){var i;a.normalizeArgs(s,u,function(e,t){i=e,u=t}),c.validateArgs("createMessage",function(t){t.string(e,"queue"),t.queueNameIsValid(e),t.callback(u)});var l=R.serialize(t,this.messageEncoder),p=o(!0,{},i),d=g.post(e+"/messages").withHeader(m.CONTENT_TYPE,'application/atom+xml;charset="utf-8"').withHeader(m.CONTENT_LENGTH,r.byteLength(l,"utf8")).withQueryOption(f.MESSAGE_TTL,p.messageTimeToLive).withQueryOption(f.VISIBILITY_TIMEOUT,p.visibilityTimeout).withBody(l),v=function(e,t){if(e.queueMessageResults=[],e.response&&e.response.body&&e.response.body.QueueMessagesList&&e.response.body.QueueMessagesList.QueueMessage){var r=e.response.body.QueueMessagesList.QueueMessage;n.isArray(r)||(r=[r]),r.forEach(function(t){var r=R.parse(t,this.messageEncoder);e.queueMessageResults.push(r)})}var s=function(t){u(t.error,e.queueMessageResults[0],t.response)};t(e,s)};this.performRequest(d,d.body,p,v)},s.prototype.getMessages=function(e,t,r){var s;a.normalizeArgs(t,r,function(e,t){s=e,r=t}),c.validateArgs("getMessages",function(t){t.string(e,"queue"),t.queueNameIsValid(e),t.callback(r)});var u=o(!0,{},s);delete u.peekOnly,this._getOrPeekMessages(e,u,r)},s.prototype.getMessage=function(e,t,r){var s;a.normalizeArgs(t,r,function(e,t){s=e,r=t}),c.validateArgs("getMessage",function(t){t.string(e,"queue"),t.queueNameIsValid(e),t.callback(r)});var u=o(!0,{},s);u.numOfMessages=1;var n=function(e,t,s){var u;t&&t.length>0&&(u=t[0]),r(e,u,s)};this.getMessages(e,u,n)},s.prototype.peekMessages=function(e,t,r){var s;a.normalizeArgs(t,r,function(e,t){s=e,r=t}),c.validateArgs("peekMessages",function(t){t.string(e,"queue"),t.queueNameIsValid(e),t.callback(r)});var u=o(!0,{},s);u.peekOnly=!0,delete u.visibilityTimeout,this._getOrPeekMessages(e,u,r)},s.prototype.peekMessage=function(e,t,r){var s;a.normalizeArgs(t,r,function(e,t){s=e,r=t}),c.validateArgs("peekMessage",function(t){t.string(e,"queue"),t.queueNameIsValid(e),t.callback(r)});var u=o(!0,{},s);u.numOfMessages=1;var n=function(e,t,s){var u;t&&t.length>0&&(u=t[0]),r(e,u,s)};this.peekMessages(e,u,n)},s.prototype.deleteMessage=function(e,t,r,s,u){var n;if(a.normalizeArgs(s,u,function(e,t){n=e,u=t}),c.validateArgs("deleteMessage",function(t){t.string(e,"queue"),t.queueNameIsValid(e),t.callback(u)}),a.objectIsNull(r))throw new Error(l.INVALID_POP_RECEIPT);if(a.objectIsNull(t))throw new Error(l.INVALID_MESSAGE_ID);var i=o(!0,{},n),p=g.del(e+"/messages/"+t).withQueryOption(f.POP_RECEIPT,r,null,!0),d=function(e,t){var r=function(e){u(e.error,e.response)};t(e,r)};this.performRequest(p,null,i,d)},s.prototype.clearMessages=function(e,t,r){var s;a.normalizeArgs(t,r,function(e,t){s=e,r=t}),c.validateArgs("clearMessages",function(t){t.string(e,"queue"),t.queueNameIsValid(e),t.callback(r)});var u=o(!0,{},s),n=g.del(e+"/messages"),i=function(e,t){var s=function(e){r(e.error,e.response)};t(e,s)};this.performRequest(n,null,u,i)},s.prototype.updateMessage=function(e,t,s,u,n,i){var p;if(a.normalizeArgs(n,i,function(e,t){p=e,i=t}),c.validateArgs("updateMessage",function(t){t.string(e,"queue"),t.queueNameIsValid(e),t.callback(i)}),a.objectIsNull(s))throw new Error(l.INVALID_POP_RECEIPT);if(a.objectIsNull(t))throw new Error(l.INVALID_MESSAGE_ID);var d=o(!0,{},p),v=null;d.messageText&&(v=R.serialize(d.messageText,this.messageEncoder));var E=v?r.byteLength(v,"utf8"):0,q=g.put(e+"/messages/"+t).withHeader(m.CONTENT_TYPE,'application/atom+xml;charset="utf-8"').withHeader(m.CONTENT_LENGTH,E).withQueryOption(f.POP_RECEIPT,s,null,!0).withQueryOption(f.VISIBILITY_TIMEOUT,u).withBody(v),y=function(r,s){r.queueMessageResult=null,r.error||(r.queueMessageResult=new R(e,t),r.queueMessageResult.getPropertiesFromHeaders(r.response.headers));var u=function(e){i(e.error,e.queueMessageResult,e.response)};s(r,u)};this.performRequest(q,q.body,d,y)},s.prototype.getQueueAcl=function(e,t,r){var s;a.normalizeArgs(t,r,function(e,t){s=e,r=t}),c.validateArgs("getQueueAcl",function(t){t.string(e,"queue"),t.queueNameIsValid(e),t.callback(r)});var u=o(!0,{},s),n=g.get(e).withQueryOption(f.COMP,"acl");u.requestLocationMode=d.RequestLocationMode.PRIMARY_OR_SECONDARY;var i=function(t,s){t.queueResult=null,t.error||(t.queueResult=new E(e),t.queueResult.getPropertiesFromHeaders(t.response.headers),t.queueResult.signedIdentifiers=q.parse(t.response.body));var u=function(e){r(e.error,e.queueResult,e.response)};s(t,u)};this.performRequest(n,null,u,i)},s.prototype.setQueueAcl=function(e,t,s,u){var i;a.normalizeArgs(s,u,function(e,t){i=e,u=t}),c.validateArgs("setQueueAcl",function(t){t.string(e,"queue"),t.queueNameIsValid(e),t.callback(u)});var p=o(!0,{},i),d=null;if(t){if(n.isArray(t))throw new TypeError(l.INVALID_SIGNED_IDENTIFIERS);d=q.serialize(t)}var v=g.put(e).withQueryOption(f.COMP,"acl").withHeader(m.CONTENT_LENGTH,a.objectIsNull(d)?0:r.byteLength(d)).withBody(d),R=function(r,s){r.containerResult=null,r.error||(r.queueResult=new E(e),r.queueResult.getPropertiesFromHeaders(r.response.headers),t&&(r.queueResult.signedIdentifiers=t));var n=function(e){u(e.error,e.queueResult,e.response)};s(r,n)};this.performRequest(v,v.body,p,R)},s.prototype.generateSharedAccessSignature=function(e,t){if(!this.storageCredentials||!this.storageCredentials.generateSignedQueryString)throw new Error(l.CANNOT_CREATE_SAS_WITHOUT_ACCOUNT_KEY);return c.validateArgs("generateSharedAccessSignature",function(r){r.string(e,"queue"),r.queueNameIsValid(e),r.object(t,"sharedAccessPolicy")}),this.storageCredentials.generateSignedQueryString(d.ServiceType.Queue,e,t,null)},s.prototype._doesQueueExist=function(e,t,r,s){var u;a.normalizeArgs(r,s,function(e,t){u=e,s=t}),c.validateArgs("doesQueueExist",function(t){t.string(e,"queue"),t.queueNameIsValid(e),t.callback(s)});var n=o(!0,{},u),i=g.head(e).withQueryOption(f.COMP,"metadata");t===!1&&(n.requestLocationMode=v.PRIMARY_OR_SECONDARY);var l=function(t,r){t.queueResult=new E(e),t.queueResult.exists=!1,t.error?t.error&&t.error.statusCode===d.HttpConstants.HttpResponseCodes.NotFound&&(t.error=null,t.queueResult.exists=!1,t.response.isSuccessful=!0):(t.queueResult.exists=!0,t.queueResult.getPropertiesFromHeaders(t.response.headers));var u=function(e){s(e.error,e.queueResult,e.response)};r(t,u)};this.performRequest(i,null,n,l)},s.prototype._getOrPeekMessages=function(e,t,r){var s;a.normalizeArgs(t,r,function(e,t){s=e,r=t}),c.validateArgs("_getOrPeekMessages",function(t){t.string(e,"queue"),t.queueNameIsValid(e),t.callback(r)});var u=o(!0,{},s);u.numOfMessages||(u.numOfMessages=1);var i=g.get(e+"/messages").withQueryOption(f.NUM_OF_MESSAGES,u.numOfMessages).withQueryOption(f.VISIBILITY_TIMEOUT,u.visibilityTimeout).withQueryOption(f.PEEK_ONLY,u.peekOnly);u.peekOnly&&(u.requestLocationMode=v.PRIMARY_OR_SECONDARY);var l=this.messageEncoder,p=function(e,t){if(e.queueMessageResults=null,!e.error&&(e.queueMessageResults=[],e.response.body.QueueMessagesList&&e.response.body.QueueMessagesList.QueueMessage)){var s=e.response.body.QueueMessagesList.QueueMessage;n.isArray(s)||(s=[s]),s.forEach(function(t){var r=R.parse(t,l);e.queueMessageResults.push(r)})}var u=function(e){r(e.error,e.queueMessageResults,e.response)};t(e,u)};this.performRequest(i,null,u,p)},s.prototype.getUrl=function(e,t,r){return c.validateArgs("getUrl",function(t){t.string(e,"queue"),t.queueNameIsValid(e)}),this._getUrl(e,t,r)},t.exports=s}).call(this,e("buffer").Buffer)},{"./../../common/common":5,"./models/queuemessageresult":53,"./models/queueresult":54,"./queuemessageencoder":55,buffer:"buffer",extend:431,underscore:577,util:"util"}],54:[function(e,t,r){function s(e,t){e&&(this.name=e),t&&(this.metadata=t)}var u=e("./../../../common/common").Constants,n=u.HeaderConstants;s.parse=function(e){var t=new s;for(var r in e)e.hasOwnProperty(r)&&(t[r.toLowerCase()]=e[r]);return t},s.prototype.getPropertiesFromHeaders=function(e){var t=this,r=function(r,s,u){!t[r]&&e[s.toLowerCase()]&&(u?t[r]=u(e[s.toLowerCase()]):t[r]=e[s.toLowerCase()])};r("approximateMessageCount",n.APPROXIMATE_MESSAGES_COUNT,parseInt)},t.exports=s},{"./../../../common/common":5}],53:[function(e,t,r){function s(e,t,r){e&&(this.queue=e),t&&(this.messageId=t),r&&(this.popReceipt=r)}var u=e("./../../../common/common"),n=u.util,o=u.xmlbuilder,i=u.Constants,a=i.HeaderConstants;s.serialize=function(e,t){var r=o.create();if(r=r.begin(i.QueueConstants.QUEUE_MESSAGE_ELEMENT,{version:"1.0",encoding:"utf-8"}),e){var s;s=null!==t&&void 0!==t?t.encode(e):e,r.ele(i.QueueConstants.MESSAGE_TEXT_ELEMENT).txt(s).up()}else r.ele(i.QueueConstants.MESSAGE_TEXT_ELEMENT).up();return r.doc().toString()},s.parse=function(e,t){var r=new s;for(var u in e)if(u===i.QueueConstants.MESSAGE_TEXT_ELEMENT)null!==t&&void 0!==t?r.messageText=t.decode(e[u]):r.messageText=e[u];else{var o=n.normalizePropertyNameFromXML(u);r[o]=e[u]}return r.dequeueCount&&(r.dequeueCount=parseInt(r.dequeueCount)),r},s.prototype.getPropertiesFromHeaders=function(e){var t=this,r=function(r,s){!t[r]&&e[s.toLowerCase()]&&(t[r]=e[s.toLowerCase()])};r("popReceipt",a.POP_RECEIPT),r("timeNextVisible",a.TIME_NEXT_VISIBLE)},t.exports=s},{"./../../../common/common":5}],55:[function(e,t,r){(function(r){function s(){}function u(){}function n(){}function o(){}var i=e("util");s.prototype.encode=function(e){return e},s.prototype.decode=function(e){return e},i.inherits(u,s),u.prototype.encode=function(e){return new r(e,"utf8").toString("base64")},u.prototype.decode=function(e){return new r(e,"base64").toString("utf8")},i.inherits(n,s),n.prototype.encode=function(e){return e.toString("base64")},n.prototype.decode=function(e){return new r(e,"base64")},i.inherits(o,s),o.prototype.encode=function(e){return e.replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;").replace(/"/gm,"&quot;").replace(/'/gm,"&apos;")},o.prototype.decode=function(e){return e.replace(/&amp;/gm,"&").replace(/&lt;/gm,"<").replace(/&gt;/gm,">").replace(/&quot;/gm,'"').replace(/&apos;/gm,"'")},t.exports=s,t.exports.TextBase64QueueMessageEncoder=u,t.exports.BinaryBase64QueueMessageEncoder=n,t.exports.TextXmlQueueMessageEncoder=o}).call(this,e("buffer").Buffer)},{buffer:"buffer",util:"util"}]},{},[3]);