// Azure Storage JavaScript Client Library 0.2.1-preview.3
// Copyright (c) Microsoft and contributors.  All rights reserved.

require=function e(t,r,n){function o(a,s){if(!r[a]){if(!t[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(i)return i(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var c=r[a]={exports:{}};t[a][0].call(c.exports,function(e){var r=t[a][1][e];return o(r?r:e)},c,c.exports,e,t,r,n)}return r[a].exports}for(var i="function"==typeof require&&require,a=0;a<n.length;a++)o(n[a]);return o}({4:[function(e,t,r){var n=window.AzureStorage||{};n.generateDevelopmentStorageCredentials=function(e){var t="UseDevelopmentStorage=true;";return e&&(t+="DevelopmentStorageProxyUri="+e),t};var o=e("../lib/services/table/tableservice");n.TableService=o,n.TableQuery=e("../lib/services/table/tablequery"),n.TableBatch=e("../lib/services/table/tablebatch"),n.TableUtilities=e("../lib/services/table/tableutilities"),n.createTableService=function(e,t,r){return new o(e,t,r)},n.createTableServiceWithSas=function(e,t){return new o(null,null,e,t)};var i=e("../lib/common/common"),a=i.StorageServiceClient,s=i.SharedKey;n.generateAccountSharedAccessSignature=function(e,t,r){var n=a.getStorageSettings(e,t),o=new s(n._name,n._key);return o.generateAccountSignedQueryString(r)},n.Constants=i.Constants,n.StorageUtilities=i.StorageUtilities,n.AccessCondition=i.AccessCondition,n.SR=i.SR,n.StorageServiceClient=a,n.Logger=i.Logger,n.WebResource=i.WebResource,n.Validate=i.validate,n.date=i.date,n.LinearRetryPolicyFilter=i.LinearRetryPolicyFilter,n.ExponentialRetryPolicyFilter=i.ExponentialRetryPolicyFilter,n.RetryPolicyFilter=i.RetryPolicyFilter,window.AzureStorage=n},{"../lib/common/common":5,"../lib/services/table/tablebatch":65,"../lib/services/table/tablequery":66,"../lib/services/table/tableservice":67,"../lib/services/table/tableutilities":68}],67:[function(e,t,r){(function(r){function n(e,t,r,o,i){var a=p.getStorageSettings(e,t,r,o,i);if(n.super_.call(this,a._name,a._key,a._tableEndpoint,a._usePathStyleUri,a._sasToken),this.anonymous)throw new Error(c.ANONYMOUS_ACCESS_BLOBSERVICE_ONLY);this.storageAccount&&this.storageAccessKey&&(this.storageCredentials=new E(this.storageAccount,this.storageAccessKey,this.usePathStyleUri)),this.defaultPayloadFormat=v.PayloadFormat.MINIMAL_METADATA}var o=e("util"),i=e("extend"),a=e("underscore"),s=e("./../../common/common"),l=s.util,u=s.validate,c=s.SR,p=s.StorageServiceClient,E=e("./internal/sharedkeytable"),f=e("./internal/requesthandler"),T=e("./tablequery"),d=s.WebResource,y=s.Constants,h=y.QueryStringConstants,R=y.HeaderConstants,b=y.TableConstants,_=y.RequestLocationMode,A=e("./models/tableresult"),g=e("./models/entityresult"),m=e("./models/batchresult"),N=s.ServiceStatsParser,O=s.AclResult,v=e("./tableutilities");o.inherits(n,p),n.prototype.getServiceStats=function(e,t){var r;l.normalizeArgs(e,t,function(e,n){r=e,t=n}),u.validateArgs("getServiceStats",function(e){e.callback(t)});var n=i(!0,{},r);n.requestLocationMode=y.RequestLocationMode.PRIMARY_OR_SECONDARY;var o=d.get().withQueryOption(h.COMP,"stats").withQueryOption(h.RESTYPE,"service"),a=function(e,r){e.serviceStatsResult=null,e.error||(e.serviceStatsResult=N.parse(e.response.body.StorageServiceStats));var n=function(e){t(e.error,e.serviceStatsResult,e.response)};r(e,n)};this.performRequest(o,null,n,a)},n.prototype.getServiceProperties=function(e,t){return this.getAccountServiceProperties(e,t)},n.prototype.setServiceProperties=function(e,t,r){return this.setAccountServiceProperties(e,t,r)},n.prototype.listTablesSegmented=function(e,t,r){this.listTablesSegmentedWithPrefix(null,e,t,r)},n.prototype.listTablesSegmentedWithPrefix=function(e,t,r,n){var o;l.normalizeArgs(r,n,function(e,t){o=e,n=t}),u.validateArgs("listTables",function(e){e.callback(n)});var a=i(!0,{},o);a.payloadFormat=a.payloadFormat||this.defaultPayloadFormat;var s=d.get(b.TABLE_SERVICE_TABLE_NAME);if(f.setTableRequestHeadersAndBody(s,null,a.payloadFormat),l.objectIsNull(t)||s.withQueryOption(b.NEXT_TABLE_NAME,t.nextTableName),!l.objectIsNull(e)){var c=(new T).where(b.TABLE_NAME+" >= ?",e).and(b.TABLE_NAME+" < ?",e+"{");s.withQueryOption(h.FILTER,c.toQueryObject().$filter)}if(!l.objectIsNull(a.maxResults)){var c=(new T).top(a.maxResults);s.withQueryOption(h.TOP,c.toQueryObject().$top)}a.requestLocationMode=l.getNextListingLocationMode(t);var p=function(e,t){e.listTablesResult=null,e.error||(e.listTablesResult={entries:null,continuationToken:null},e.listTablesResult.entries=A.parse(e.response),e.response.headers[b.CONTINUATION_NEXT_TABLE_NAME]&&!l.objectIsEmpty(e.response.headers[b.CONTINUATION_NEXT_TABLE_NAME])&&(e.listTablesResult.continuationToken={nextTableName:null,targetLocation:null},e.listTablesResult.continuationToken.nextTableName=e.response.headers[b.CONTINUATION_NEXT_TABLE_NAME],e.listTablesResult.continuationToken.targetLocation=e.targetLocation));var r=function(e){n(e.error,e.listTablesResult,e.response)};t(e,r)};this.performRequest(s,null,a,p)},n.prototype.getTableAcl=function(e,t,r){var n;l.normalizeArgs(t,r,function(e,t){n=e,r=t}),u.validateArgs("getTableAcl",function(t){t.string(e,"table"),t.tableNameIsValid(e),t.callback(r)});var o=i(!0,{},n);o.requestLocationMode=y.RequestLocationMode.PRIMARY_OR_SECONDARY;var a=d.get(e).withQueryOption(h.COMP,"acl"),s=function(t,n){t.tableResult=null,t.error||(t.tableResult=new A(e),t.tableResult.signedIdentifiers=O.parse(t.response.body));var o=function(e){r(e.error,e.tableResult,e.response)};n(t,o)};this.performRequest(a,null,o,s)},n.prototype.setTableAcl=function(e,t,n,o){var s;l.normalizeArgs(n,o,function(e,t){s=e,o=t}),u.validateArgs("setTableAcl",function(t){t.string(e,"table"),t.tableNameIsValid(e),t.callback(o)});var p=i(!0,{},s),E=null;if(t){if(a.isArray(t))throw new TypeError(c.INVALID_SIGNED_IDENTIFIERS);E=O.serialize(t)}var f=d.put(e).withQueryOption(h.COMP,"acl").withHeader(R.CONTENT_LENGTH,l.objectIsNull(E)?0:r.byteLength(E)).withBody(E),T=function(r,n){r.tableResult=null,r.error||(r.tableResult=new A(e),t&&(r.tableResult.signedIdentifiers=t));var i=function(e){o(e.error,e.tableResult,e.response)};n(r,i)};this.performRequest(f,f.body,p,T)},n.prototype.generateSharedAccessSignature=function(e,t){if(!this.storageCredentials||!this.storageCredentials.generateSignedQueryString)throw new Error(c.CANNOT_CREATE_SAS_WITHOUT_ACCOUNT_KEY);u.validateArgs("generateSharedAccessSignature",function(r){r.string(e,"table"),r.tableNameIsValid(e),r.object(t,"sharedAccessPolicy")});var r=e.toLowerCase();return this.storageCredentials.generateSignedQueryString(y.ServiceType.Table,r,t,null,{tableName:r})},n.prototype.doesTableExist=function(e,t,r){this._doesTableExist(e,!1,t,r)},n.prototype.createTable=function(e,t,r){var n;l.normalizeArgs(t,r,function(e,t){n=e,r=t}),u.validateArgs("createTable",function(t){t.string(e,"table"),t.tableNameIsValid(e),t.callback(r)});var o=i(!0,{},n),a=A.serialize(e),s=d.post("Tables").withHeader(R.PREFER,R.PREFER_NO_CONTENT);f.setTableRequestHeadersAndBody(s,a,this.defaultPayloadFormat);var c=function(t,n){t.tableResponse={},t.tableResponse.isSuccessful=!t.error,t.tableResponse.statusCode=t.response.statusCode,t.error||(t.tableResponse.TableName=e);var o=function(e){r(e.error,e.tableResponse,e.response)};n(t,o)};this.performRequest(s,s.body,o,c)},n.prototype.createTableIfNotExists=function(e,t,r){var n;l.normalizeArgs(t,r,function(e,t){n=e,r=t}),u.validateArgs("createTableIfNotExists",function(t){t.string(e,"table"),t.tableNameIsValid(e),t.callback(r)});var o=i(!0,{},n),a=this;a._doesTableExist(e,!0,o,function(t,n,i){var s=n.exists;n.created=!1,delete n.exists,t?r(t,n,i):s?(i.isSuccessful=!0,r(t,n,i)):a.createTable(e,o,function(e,t,n){e?e&&e.statusCode===y.HttpConstants.HttpResponseCodes.Conflict&&e.code===y.TableErrorCodeStrings.TABLE_ALREADY_EXISTS&&(e=null,t.created=!1,t.isSuccessful=!0):t.created=!0,r(e,t,n)})})},n.prototype.deleteTable=function(e,t,r){var n;l.normalizeArgs(t,r,function(e,t){n=e,r=t}),u.validateArgs("deleteTable",function(t){t.string(e,"table"),t.tableNameIsValid(e),t.callback(r)});var o=i(!0,{},n),a=d.del("Tables('"+e+"')");f.setTableRequestHeadersAndBody(a,null,this.defaultPayloadFormat);var s=function(e,t){var n=function(e){r(e.error,e.response)};t(e,n)};this.performRequest(a,null,o,s)},n.prototype.deleteTableIfExists=function(e,t,r){var n;l.normalizeArgs(t,r,function(e,t){n=e,r=t}),u.validateArgs("deleteTableIfExists",function(t){t.string(e,"table"),t.tableNameIsValid(e),t.callback(r)});var o=i(!0,{},n),a=this;a._doesTableExist(e,!0,o,function(t,n,i){t?r(t,n.exists,i):n.exists?a.deleteTable(e,o,function(e,t){var n;e?e&&e.statusCode===y.HttpConstants.HttpResponseCodes.NotFound&&e.code===y.StorageErrorCodeStrings.RESOURCE_NOT_FOUND&&(n=!1,e=null,t.isSuccessful=!0):n=!0,r(e,n,t)}):(i.isSuccessful=!0,r(t,!1,i))})},n.prototype.queryEntities=function(e,t,r,n,o){var a;l.normalizeArgs(n,o,function(e,t){a=e,o=t}),u.validateArgs("queryEntities",function(t){t.string(e,"table"),t.callback(o)});var s=i(!0,{},a);s.payloadFormat=s.payloadFormat||this.defaultPayloadFormat;var c=d.get(e);if(f.setTableRequestHeadersAndBody(c,null,s.payloadFormat),t){var p=t.toQueryObject();Object.keys(p).forEach(function(e){c.withQueryOption(e,p[e])})}l.objectIsNull(r)||(c.withQueryOption(b.NEXT_PARTITION_KEY,r.nextPartitionKey),c.withQueryOption(b.NEXT_ROW_KEY,r.nextRowKey)),s.requestLocationMode=l.getNextListingLocationMode(r);var E=function(e,t){if(e.queryEntitiesResult=null,!e.error){e.queryEntitiesResult={entries:null,continuationToken:null},e.queryEntitiesResult.entries=g.parseQuery(e.response,s.autoResolveProperties,s.propertyResolver,s.entityResolver);var r={nextPartitionKey:e.response.headers[b.CONTINUATION_NEXT_PARTITION_KEY],nextRowKey:e.response.headers[b.CONTINUATION_NEXT_ROW_KEY],targetLocation:e.targetLocation};l.IsNullOrEmptyOrUndefinedOrWhiteSpace(r.nextPartitionKey)||(e.queryEntitiesResult.continuationToken=r)}var n=function(e){o(e.error,e.queryEntitiesResult,e.response)};t(e,n)};this.performRequest(c,null,s,E)},n.prototype.retrieveEntity=function(e,t,r,n,o){var i={PartitionKey:{_:t,$:"Edm.String"},RowKey:{_:r,$:"Edm.String"}};u.validateArgs("retrieveEntity",function(e){e.stringAllowEmpty(t,"partitionKey"),e.stringAllowEmpty(r,"rowKey")}),this._performEntityOperation(b.Operations.RETRIEVE,e,i,n,o)},n.prototype.insertEntity=function(e,t,r,n){this._performEntityOperation(b.Operations.INSERT,e,t,r,n)},n.prototype.insertOrReplaceEntity=function(e,t,r,n){this._performEntityOperation(b.Operations.INSERT_OR_REPLACE,e,t,r,n)},n.prototype.replaceEntity=function(e,t,r,n){this._performEntityOperation(b.Operations.REPLACE,e,t,r,n)},n.prototype.mergeEntity=function(e,t,r,n){this._performEntityOperation(b.Operations.MERGE,e,t,r,n)},n.prototype.insertOrMergeEntity=function(e,t,r,n){this._performEntityOperation(b.Operations.INSERT_OR_MERGE,e,t,r,n)},n.prototype.deleteEntity=function(e,t,r,n){this._performEntityOperation(b.Operations.DELETE,e,t,r,n)},n.prototype.executeBatch=function(e,t,n,o){var a;if(l.normalizeArgs(n,o,function(e,t){a=e,o=t}),u.validateArgs("executeBatch",function(r){r.string(e,"table"),r.tableNameIsValid(e),r.object(t,"batch"),r.callback(o)}),!t.hasOperations())throw new Error(c.EMPTY_BATCH);var s=i(!0,{},a),p=new m(this,e,t.operations),E=p.constructWebResource(),f=p.serialize();E.withBody(f),E.withHeader(R.CONTENT_LENGTH,r.byteLength(f,"utf8"));var T=function(e,t){var r=p.parse(e),n=!0;r&&r.length>0&&r.forEach(function(t){n&&!t.response.isSuccessful&&(e=t,n=!1)}),n&&(e.operationResponses=r);var i=function(e){o(e.error,e.operationResponses,e.response)};t(e,i)};this.performRequest(E,E.body,s,T)},n.prototype._doesTableExist=function(e,t,r,n){var o;l.normalizeArgs(r,n,function(e,t){o=e,n=t}),u.validateArgs("doesTableExist",function(t){t.string(e,"table"),t.tableNameIsValid(e),t.callback(n)});var a=i(!0,{},o);t===!1&&(a.requestLocationMode=_.PRIMARY_OR_SECONDARY);var s=d.get("Tables('"+e+"')");s.withHeader(R.ACCEPT,this.defaultPayloadFormat);var c=function(t,r){t.tableResult={},t.tableResult.isSuccessful=!t.error,t.tableResult.statusCode=null===t.response||void 0===t.response?void 0:t.response.statusCode,t.tableResult.TableName=e,t.error?t.error&&t.error.statusCode===y.HttpConstants.HttpResponseCodes.NotFound&&(t.error=null,t.tableResult.exists=!1,t.response.isSuccessful=!0):t.tableResult.exists=!0;var o=function(e){n(e.error,e.tableResult,e.response)};r(t,o)};this.performRequest(s,null,a,c)},n.prototype._performEntityOperation=function(e,t,r,n,o){var a;l.normalizeArgs(n,o,function(e,t){a=e,o=t}),u.validateArgs("entityOperation",function(e){e.string(t,"table"),e.tableNameIsValid(t),e.object(r,"entityDescriptor"),"string"!=typeof r.PartitionKey&&(e.object(r.PartitionKey,"entityDescriptor.PartitionKey"),e.stringAllowEmpty(r.PartitionKey._,"entityDescriptor.PartitionKey._")),"string"!=typeof r.RowKey&&(e.object(r.RowKey,"entityDescriptor.RowKey"),e.stringAllowEmpty(r.RowKey._,"entityDescriptor.RowKey._")),e.callback(o)});var s=i(!0,{},a);s.payloadFormat=s.payloadFormat||this.defaultPayloadFormat;var c=f.constructEntityWebResource(e,t,r,s),p=function(t,r){var n;e===b.Operations.DELETE?n=function(e){o(e.error,e.response)}:(t.entityResponse=null,t.error||(t.entityResponse=g.parseEntity(t.response,s.autoResolveProperties,s.propertyResolver,s.entityResolver)),n=function(e){o(e.error,e.entityResponse,e.response)}),r(t,n)};this.performRequest(c,c.body,s,p)},n.prototype.getUrl=function(e,t,r){return u.validateArgs("getUrl",function(t){t.string(e,"table"),t.tableNameIsValid(e)}),this._getUrl(e,t,r)},t.exports=n}).call(this,e("buffer").Buffer)},{"./../../common/common":5,"./internal/requesthandler":60,"./internal/sharedkeytable":61,"./models/batchresult":62,"./models/entityresult":63,"./models/tableresult":64,"./tablequery":66,"./tableutilities":68,buffer:"buffer",extend:431,underscore:577,util:"util"}],64:[function(e,t,r){function n(e){this.name=e}var o=e("../internal/odatahandler");n.serialize=function(e){return JSON.stringify({TableName:e})},n.parse=function(e){var t=null;return e.body&&(t=o.parseJsonTables(e.body)),t},r=t.exports=n},{"../internal/odatahandler":59}],62:[function(e,t,r){function n(e,t,r){this.tableService=e,this.table=t,this.operations=r,this.batchBoundary="batch_"+n._getBoundary(),this.changesetBoundary="changeset_"+n._getBoundary()}var o=e("./../../../common/common"),i=e("./../../../common/md5-wrapper"),a=o.StorageServiceClient,s=o.WebResource,l=o.Constants,u=l.HeaderConstants,c=l.TableConstants,p=e("../internal/requesthandler"),E=e("./entityresult");n._getBoundary=function(){return(new i).createMd5Hash().update(""+(new Date).getTime()).digest("hex")},n.prototype.constructWebResource=function(){var e=s.post("$batch").withRawResponse(!0);return e.withHeader(u.CONTENT_TYPE,'multipart/mixed; charset="utf-8"; boundary='+this.batchBoundary),e.withHeader(u.DATA_SERVICE_VERSION,"3.0;"),e.withHeader(u.MAX_DATA_SERVICE_VERSION,"3.0;NetFx"),e},n.prototype.serialize=function(){var e="--"+this.batchBoundary+"\n";if(1===this.operations.length&&this.operations[0].type===c.Operations.RETRIEVE)e+=u.CONTENT_TYPE+": application/http\n",e+=u.CONTENT_TRANSFER_ENCODING+": binary\n\n",e+=this._serializeOperation(this.operations[0]);else{e+=u.CONTENT_TYPE+': multipart/mixed;charset="utf-8";boundary='+this.changesetBoundary+"\n\n";for(var t=0;t<this.operations.length;t++)e+="--"+this.changesetBoundary+"\n",e+=u.CONTENT_TYPE+": application/http\n",e+=u.CONTENT_TRANSFER_ENCODING+": binary\n\n",e+=this._serializeOperation(this.operations[t],t)+"\n";e+="--"+this.changesetBoundary+"--\n"}return e+="--"+this.batchBoundary+"--"},n.prototype._serializeOperation=function(e,t){e.options.payloadFormat=e.options.payloadFormat||this.tableService.defaultPayloadFormat;var r=p.constructEntityWebResource(e.type,this.table,e.entity,e.options);t&&(r.headers[u.CONTENT_ID]=t),r.headers[u.CONTENT_TYPE]&&(r.headers[u.CONTENT_TYPE]+="type=entry"),this.tableService._setRequestUrl(r);var n=r.method+" "+r.uri+" HTTP/1.1\n";return Object.keys(r.headers).forEach(function(e){n+=e+": "+r.headers[e]+"\n"}),n+="\n",n+=r.body||""},n.prototype.parse=function(e){var t=null;if(e&&e.response&&e.response.body&&"string"==typeof e.response.body){t=[];var r=e.response.body.split(c.CHANGESET_DELIMITER);1===r.length&&(r=e.response.body.split(c.BATCH_DELIMITER));var n=this;r.forEach(function(e){var r=e.indexOf("HTTP/1.1");if(r!==-1){e=e.substring(r);var o=n._parseOperation(e);t.push(o)}})}return t},n.prototype._parseOperation=function(e){var t={error:null,response:{}},r=e.split("\r\n");if(r.length>0){var n=r.shift().split(" ");n.length>=2&&(t.response.statusCode=parseInt(n[1]),t.response.isSuccessful=s.validResponse(t.response.statusCode)),t.response.headers={},t.response.body="";var o=!1;if(r.forEach(function(e){if(""!==e||o)if(o)t.response.body+=e;else{var r=e.indexOf(":");r!==-1&&(t.response.headers[e.substring(0,r).trim().toLowerCase()]=e.substring(r+1).trim())}else o=!0}),a._parseResponse(t.response,this.tableService.xml2jsSettings),t.response.isSuccessful||(t.error=a._normalizeError(t.response.body,t.response)),!t.error){var i,l,c=t.response.headers[u.CONTENT_ID]||0;if(c&&this.operations[c]){var p=this.operations[c].options;i=p.propertyResolver,l=p.entityResolver}t.entity=E.parseEntity(t.response,i,l)}}return t},t.exports=n},{"../internal/requesthandler":60,"./../../../common/common":5,"./../../../common/md5-wrapper":12,"./entityresult":63}],61:[function(e,t,r){function n(e,t,r){n.super_.call(this,e,t,r)}var o=e("util"),i=e("./../../../common/common"),a=i.SharedKey,s=i.util,l=i.Constants,u=l.HeaderConstants,c=l.QueryStringConstants;o.inherits(n,a),n.prototype.signRequest=function(e,t){var r=function(e){return s.objectIsNull(e)?"\n":e+"\n"},n=e.method+"\n"+r(e.headers[u.CONTENT_MD5])+r(e.headers[u.CONTENT_TYPE])+r(e.headers[u.MS_DATE])+this._getCanonicalizedResource(e),o=this.signer.sign(n);e.withHeader(u.AUTHORIZATION,"SharedKey "+this.storageAccount+":"+o),t(null)},n.prototype._getCanonicalizedResource=function(e){var t="/";e.path&&(t=e.path);var r="/"+this.storageAccount+t,n=e.queryString;return n[c.COMP]&&(r+="?comp="+n[c.COMP]),r},t.exports=n},{"./../../../common/common":5,util:"util"}],60:[function(e,t,r){(function(n){function o(e,t,r){var n="/"+e;if("string"!=typeof t||"string"!=typeof r)throw new Error(l.INCORRECT_ENTITY_KEYS);return t=t.replace(/'/g,"''"),r=r.replace(/'/g,"''"),n=n+"(PartitionKey='"+encodeURIComponent(t.toString("utf8"))+"',RowKey='"+encodeURIComponent(r.toString("utf8"))+"')",n}var i=e("util"),a=e("./../../../common/common"),s=a.WebResource,l=a.SR,u=a.Constants,c=u.HeaderConstants,p=u.TableConstants,E=e("../models/entityresult");r=t.exports,r.constructEntityWebResource=function(e,t,n,a){var u=null;if(e===p.Operations.INSERT)u=s.post(t).withHeader(c.PREFER,a.echoContent?c.PREFER_CONTENT:c.PREFER_NO_CONTENT);else{var f,T;f="string"==typeof n.PartitionKey?n.PartitionKey:n.PartitionKey[p.ODATA_VALUE_MARKER],T="string"==typeof n.RowKey?n.RowKey:n.RowKey[p.ODATA_VALUE_MARKER];var d=o(t,f,T);if(e===p.Operations.DELETE)u=s.del(d);else if(e===p.Operations.MERGE||e===p.Operations.INSERT_OR_MERGE)u=s.merge(d);else if(e===p.Operations.REPLACE||e===p.Operations.INSERT_OR_REPLACE)u=s.put(d);else{if(e!==p.Operations.RETRIEVE)throw new Error(i.format(l.INVALID_TABLE_OPERATION,e));u=s.get(d)}}e!==p.Operations.DELETE&&e!==p.Operations.REPLACE&&e!==p.Operations.MERGE||u.withHeader(c.IF_MATCH,E.getEtag(n)||"*");var y;return e!==p.Operations.DELETE&&e!==p.Operations.RETRIEVE&&(y=E.serialize(n)),r.setTableRequestHeadersAndBody(u,y,a.payloadFormat),u},r.setTableRequestHeadersAndBody=function(e,t,r){t&&e.withHeader(c.CONTENT_LENGTH,n.byteLength(t,"utf8")).withBody(t).withHeader(c.CONTENT_TYPE,c.JSON_CONTENT_TYPE_VALUE),e.withHeader(c.ACCEPT,r).withHeader(c.MAX_DATA_SERVICE_VERSION,p.DEFAULT_DATA_SERVICE_VERSION)}}).call(this,e("buffer").Buffer)},{"../models/entityresult":63,"./../../../common/common":5,buffer:"buffer",util:"util"}],63:[function(e,t,r){var n=e("./../../../common/common"),o=n.Constants,i=o.TableConstants,a=o.HeaderConstants,s=e("../internal/odatahandler");r=t.exports,r.serialize=function(e){return s.serializeJson(e)},r.parseQuery=function(e,t,r,n){var o={};return e.body&&(o=s.parseJsonEntities(e.body,t,r,n)),o},r.parseEntity=function(e,t,r,n){var o={};return e.body&&(o=s.parseJsonSingleEntity(e.body,t,r,n)),e.headers&&e.headers[a.ETAG.toLowerCase()]&&(o[i.ODATA_METADATA_MARKER]||(o[i.ODATA_METADATA_MARKER]={}),o[i.ODATA_METADATA_MARKER].etag=e.headers[a.ETAG.toLowerCase()]),o},r.getEtag=function(e){var t;return e&&e[i.ODATA_METADATA_MARKER]&&(t=e[i.ODATA_METADATA_MARKER].etag),t}},{"../internal/odatahandler":59,"./../../../common/common":5}],59:[function(e,t,r){(function(n){var o=e("util"),i=e("./../../../common/common"),a=i.util,s=i.SR,l=i.Constants,u=e("./edmhandler"),c=l.TableConstants.ODATA_PREFIX.length,p=l.TableConstants.ODATA_TYPE_SUFFIX.length;r=t.exports,r.serializeJson=function(e){function t(e){if(a.objectIsNull(e))return{_:e};if("object"==typeof e&&e.hasOwnProperty(l.TableConstants.ODATA_VALUE_MARKER))return e;var t={_:e};return t[l.TableConstants.ODATA_TYPE_MARKER]=u.propertyType(e,!0),t}var r={};for(var n in e)if(n!==l.TableConstants.ODATA_METADATA_MARKER){var o=t(e[n]);if(!a.objectIsNull(o[l.TableConstants.ODATA_VALUE_MARKER])){var i=o[l.TableConstants.ODATA_VALUE_MARKER],s=o[l.TableConstants.ODATA_TYPE_MARKER];void 0===s&&(s=u.propertyType(i,!0)),r[n]=u.serializeValue(s,i),u.isTypeRequired(s,i)&&(r[n+l.TableConstants.ODATA_TYPE_SUFFIX]=s)}}var c=function(e,t){return t===Number.POSITIVE_INFINITY?"Infinity":t===Number.NEGATIVE_INFINITY?"-Infinity":a.objectIsNaN(t)?"NaN":t};return JSON.stringify(r,c)},r.parseJsonTables=function(e){var t=[];if(e.value)for(var r=0;r<e.value.length;r++){var n=e.value[r].TableName;t.push(n)}return t},r.parseJsonEntities=function(e,t,n,o){if(e.value){for(var i=[],a=0;a<e.value.length;a++){var s=e.value[a],l=r.parseJsonSingleEntity(s,t,n,o);i.push(l)}return i}return[r.parseJsonSingleEntity(e,t,n,o)]},r.parseJsonSingleEntity=function(e,t,r,i){var E={},f={PartitionKey:"Edm.String",RowKey:"Edm.String",Timestamp:"Edm.DateTime"},T={};for(var d in e)a.stringStartsWith(d,l.TableConstants.ODATA_PREFIX)?T[d.slice(c)]=e[d]:a.stringEndsWith(d,l.TableConstants.ODATA_TYPE_SUFFIX)?f[d.slice(0,d.length-p)]=e[d]:E[d]=e[d];if(!T.etag&&E.Timestamp){var y=new n(E.Timestamp).toString();T.etag="W/\"datetime'"+y+"'\""}var h={};for(var d in E)if(E.hasOwnProperty(d)){var R=f[d];h[d]={},r&&(R=r(E.PartitionKey,E.RowKey,d,E[d],R)),!R&&t&&(R=u.propertyType(E[d],!1)),R&&(h[d][l.TableConstants.ODATA_TYPE_MARKER]=R);try{h[d][l.TableConstants.ODATA_VALUE_MARKER]=u.deserializeValueFromJson(R,E[d])}catch(e){throw r?new Error(o.format(s.INVALID_PROPERTY_RESOLVER,d,R,E[d])):e}}return h[l.TableConstants.ODATA_METADATA_MARKER]=T,i&&(h=i(h)),h}}).call(this,e("buffer").Buffer)},{"./../../../common/common":5,"./edmhandler":58,buffer:"buffer",util:"util"}],66:[function(e,t,r){function n(){this._fields=[],this._where=[],this._top=null}var o=e("underscore"),i=e("util"),a=e("./../../common/common"),s=a.util,l=a.SR,u=a.Constants.QueryStringConstants,c=e("./internal/edmhandler"),p=e("./tableutilities"),E=p.QueryComparisons,f=p.TableOperators,T=p.EdmType;n.prototype.select=function(){var e=this;return arguments&&o.each(arguments,function(t){e._fields.push(t)}),this},n.prototype.top=function(e){return this._top=e,this},n.prototype.where=function(e){return this._where.push(n._encodeConditionString(e,arguments)),this},n.int32Filter=function(e,t,r){return n._concatFilterString(e,t,r,T.INT32)},n.int64Filter=function(e,t,r){return n._concatFilterString(e,t,r,T.INT64)},n.doubleFilter=function(e,t,r){return n._concatFilterString(e,t,r,T.DOUBLE)},n.booleanFilter=function(e,t,r){return n._concatFilterString(e,t,r,T.BOOLEAN)},n.dateFilter=function(e,t,r){return n._concatFilterString(e,t,r,T.DATETIME)},n.guidFilter=function(e,t,r){return n._concatFilterString(e,t,r,T.GUID)},n.binaryFilter=function(e,t,r){return n._concatFilterString(e,t,r,T.BINARY)},n.stringFilter=function(e,t,r){return n._concatFilterString(e,t,r,T.STRING)},n.combineFilters=function(e,t,r){return e+" "+t+" "+r},n.prototype.and=function(e){if(0===this._where.length)throw new Error(i.format(l.QUERY_OPERATOR_REQUIRES_WHERE,"AND"));return this._where.push(" and "+n._encodeConditionString(e,arguments)),this},n.prototype.or=function(e){if(0===this._where.length)throw new Error(i.format(l.QUERY_OPERATOR_REQUIRES_WHERE,"OR"));return this._where.push(" or "+n._encodeConditionString(e,arguments)),this},n.prototype.toQueryObject=function(){var e={};return this._fields.length>0&&(e[u.SELECT]=this._fields.join(",")),this._where.length>0&&(e[u.FILTER]=this._where.join("")),this._top&&(e[u.TOP]=this._top),e},n._concatFilterString=function(e,t,r,n){if(s.objectIsNull(e))throw new Error(i.format(l.ARGUMENT_NULL_OR_UNDEFINED,"propertyName"));if(s.objectIsNull(t))throw new Error(i.format(l.ARGUMENT_NULL_OR_UNDEFINED,"operation"));if(s.objectIsNull(r))throw new Error(i.format(l.ARGUMENT_NULL_OR_UNDEFINED,"value"));var o=c.serializeQueryValue(r,n);return e+" "+t+" "+o},n._encodeConditionString=function(e,t){var r=n._replaceOperators(e);if(t.length>1){for(var o=r.split(/(\?string\?|\?int32\?|\?int64\?|\?bool\?|\?double\?|\?date\?|\?binary\?|\?guid\?|\?)/),i=1,a=0;a<o.length&&i<t.length;a++)if(0===o[a].indexOf("?")){var s=n._getEdmType(o[a]);o[a]=c.serializeQueryValue(t[i],s),i++}r=o.join("")}return r},n._getEdmType=function(e){switch(e){case"?binary?":return T.BINARY;case"?int64?":return T.INT64;case"?date?":return T.DATETIME;case"?guid?":return T.GUID;case"?int32?":return T.INT32;case"?double?":return T.DOUBLE;case"?bool?":return T.BOOLEAN;case"?string?":return T.STRING;default:return}},n._replaceOperators=function(e){var t=e.replace(/ == /g," "+E.EQUAL+" ");return t=t.replace(/ != /g," "+E.NOT_EQUAL+" "),t=t.replace(/ >= /g," "+E.GREATER_THAN_OR_EQUAL+" "),t=t.replace(/ > /g," "+E.GREATER_THAN+" "),t=t.replace(/ <= /g," "+E.LESS_THAN_OR_EQUAL+" "),t=t.replace(/ < /g," "+E.LESS_THAN+" "),t=t.replace(/ \&\& /g," "+f.AND+" "),t=t.replace(/ \|\| /g," "+f.OR+" "),t=t.replace(/!/g,f.NOT)},t.exports=n},{"./../../common/common":5,"./internal/edmhandler":58,"./tableutilities":68,underscore:577,util:"util"}],58:[function(e,t,r){(function(t){var n=e("underscore"),o=e("util"),i=e("node-uuid"),a=e("./../../../common/common"),s=a.util,l=a.SR,u=e("../tableutilities"),c=u.EdmType;r.propertyType=function(e,t){return n.isNumber(e)?t?s.objectIsInt(e)?"Edm.Int32":"Edm.Double":null:n.isBoolean(e)?"Edm.Boolean":n.isDate(e)?"Edm.DateTime":"Edm.String"},r.deserializeValueFromJson=function(e,r){if(!e)return r;switch(e){case c.BINARY:return new t(r,"base64");case c.DATETIME:return new Date(r);case c.GUID:return r;case c.DOUBLE:return"number"!=typeof r?parseFloat(r):r;case c.INT32:case c.INT64:case c.STRING:case c.BOOLEAN:return r;default:throw new Error(o.format(l.TYPE_NOT_SUPPORTED,e))}},r.serializeValue=function(e,r){switch(e){case c.BINARY:return t.isBuffer(r)?r.toString("base64"):r;case c.DATETIME:return n.isDate(r)?r.toISOString():r;case c.GUID:return t.isBuffer(r)||n.isArray(r)?i.unparse(r):r;case c.INT64:case c.DOUBLE:return r.toString();case c.INT32:return r===Number.POSITIVE_INFINITY?"Infinity":r===Number.NEGATIVE_INFINITY?"-Infinity":s.objectIsNaN(r)?"NaN":r;case c.STRING:case c.BOOLEAN:return r;default:throw new Error(l.TYPE_NOT_SUPPORTED+e)}},r.isTypeRequired=function(e,t){switch(e){case c.BINARY:case c.INT64:case c.DATETIME:case c.GUID:case c.DOUBLE:return!0;case c.INT32:return!("number"==typeof t&&t!==Number.POSITIVE_INFINITY&&t!==Number.NEGATIVE_INFINITY&&!s.objectIsNaN(t));case c.STRING:case c.BOOLEAN:return!1;default:throw new Error(o.format(l.TYPE_NOT_SUPPORTED,e))}},r.serializeQueryValue=function(e,t){var i=t||r.propertyType(e,!0);switch(i){case c.INT32:return e.toString();case c.BOOLEAN:return e?"true":"false";case c.DOUBLE:return e.toString();case c.INT64:return e.toString()+"L";case c.DATETIME:if(n.isDate(e)){var a=e.toISOString();return"datetime'"+a+"'"}throw new Error(o.format(l.INVALID_EDM_TYPE,e,t));case c.GUID:return"guid'"+e.toString()+"'";case c.BINARY:return"X'"+e.toString("hex")+"'";default:return"'"+e.toString().replace(/'/g,"''")+"'"}}}).call(this,e("buffer").Buffer)},{"../tableutilities":68,"./../../../common/common":5,buffer:"buffer","node-uuid":437,underscore:577,util:"util"}],65:[function(e,t,r){function n(){this.operations=[],this.pk=null,this.retrieve=!1}var o=e("extend"),i=e("./../../common/common"),a=i.SR,s=i.validate,l=i.Constants,u=l.TableConstants;n.prototype.clear=function(){this.operations=[]},n.prototype.hasOperations=function(){return this.operations.length>0},n.prototype.size=function(){return this.operations.length},n.prototype.retrieveEntity=function(e,t,r){var n={PartitionKey:{_:e,$:"Edm.String"},RowKey:{_:t,$:"Edm.String"}};this.addOperation(u.Operations.RETRIEVE,n,r)},n.prototype.insertEntity=function(e,t){this.addOperation(u.Operations.INSERT,e,t)},n.prototype.deleteEntity=function(e){this.addOperation(u.Operations.DELETE,e)},n.prototype.mergeEntity=function(e){this.addOperation(u.Operations.MERGE,e)},n.prototype.replaceEntity=function(e){this.addOperation(u.Operations.REPLACE,e)},n.prototype.insertOrReplaceEntity=function(e){this.addOperation(u.Operations.INSERT_OR_REPLACE,e)},n.prototype.insertOrMergeEntity=function(e){this.addOperation(u.Operations.INSERT_OR_MERGE,e)},n.prototype.addOperation=function(e,t,r){if(s.validateArgs("addOperation",function(e){e.object(t,"entity"),e.object(t.PartitionKey,"entity.PartitionKey"),e.object(t.RowKey,"entity.RowKey"),e.stringAllowEmpty(t.PartitionKey._,"entity.PartitionKey._"),e.stringAllowEmpty(t.RowKey._,"entity.RowKey._")}),this.operations.length>=100)throw new Error(a.BATCH_TOO_LARGE);if(e===u.Operations.RETRIEVE){if(this.hasOperations())throw new Error(a.BATCH_ONE_RETRIEVE);this.retrieve=!0}else if(this.retrieve)throw new Error(a.BATCH_ONE_RETRIEVE);if(this.hasOperations()){if(t.PartitionKey._!==this.pk)throw new Error(a.BATCH_ONE_PARTITION_KEY)}else this.pk=t.PartitionKey._;var n=o(!0,{},r);this.operations.push({type:e,entity:t,options:n})},n.prototype.getOperation=function(e){return this.operations[e]},n.prototype.removeOperation=function(e){var t=this.operations.splice(e,1)[0];return this.hasOperations()||(this.pk=null,this.retrieve=!1),t},t.exports=n},{"./../../common/common":5,extend:431}]},{},[4]);